<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>品码斋-Ruby元编程技巧</title>
    <meta name="description" content="资深码农，技术兴趣广泛，好读书，求甚解">
    <link rel="canonical" href="http://jameszhan.github.io/2014/09/01/ruby-metagramming.html">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/assets/stylesheets/main.css">
</head>


<body>


<header class="navbar navbar-inverse navbar-fixed-top" role="banner">
    <div class="container">
        <div class="navbar-header">
            <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                <span class="sr-only">品码斋</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">品码斋</a>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
            <ul class="nav navbar-nav">
                <li><a class="page-link" href="/blogs/">博客</a></li>
                <li><a class="page-link" href="/bookmarks/">书签</a></li>
                <li><a class="page-link" href="/books/">图书</a></li>
                <li><a class="page-link" href="/resoruces/">资源</a></li>
                <li><a class="page-link" href="/news/">他山之石</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a class="page-link" href="/about/">关于我</a></li>
                <li><a class="page-link" href="https://github.com/jameszhan">GitHub</a></li>
            </ul>
        </nav>
    </div>
</header>




<div class="container">
    <div class="col-md-9">
        <div class="post">

    <header class="post-header">
        <h1 class="post-title">Ruby元编程技巧</h1>
        <p class="post-meta">
            2014年09月01日 •
            詹子知(James Zhan)
        </p>
    </header>

    <article class="post-content">
        <p>（摘自ruby元编程原书附录）</p>

<h2 id="常见惯用法">常见惯用法</h2>

<h3 id="a.1-拟态方法（mimic-methods）">A.1 拟态方法（Mimic Methods）</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">puts</span> <span class="s2">&quot;Hello,world!&quot;</span>
</code></pre></div>
<p>这里的 puts 实际上是个方法，完整写法</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">puts</span><span class="p">(</span><span class="s2">&quot;Hello,world!&quot;</span><span class="p">)</span>
</code></pre></div>
<p>去掉括号的写法使得它像个关键字，同时也更为简洁，因此称之为拟态方法。</p>

<p>属性的问题：</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">C</span>
    <span class="k">def</span> <span class="nf">my_attr</span><span class="o">=</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="vi">@p</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">my_attr</span>
        <span class="vi">@p</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">new</span>
<span class="n">obj</span><span class="o">.</span><span class="n">my_attr</span> <span class="o">=</span> <span class="s1">&#39;some value&#39;</span>
<span class="n">obj</span><span class="o">.</span><span class="n">my_attr</span>         <span class="c1"># =&gt; &#39;some value&#39;</span>
</code></pre></div>
<p>代码obj.my<u>attr = &#39;some value&#39;的功能与代码obj.my</u>attr=(&#39;some value&#39;)的功能是相同的，不过前者看起来更清爽。</p>

<p>来自 Camping 的例子，这里的 R 实际上是一个方法，&#39;/help&#39; 是它的参数，返回值是一个 Class的实例。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Help</span> <span class="o">&lt;</span> <span class="n">R</span> <span class="s1">&#39;/help&#39;</span>
    <span class="k">def</span> <span class="nf">get</span>
        <span class="c1"># rendering for HTTP GET...</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3 id="a.2-空指针保护（nil-guards）">A.2 空指针保护（Nil Guards）</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">a</span> <span class="o">||=</span> <span class="o">[]</span>
</code></pre></div>
<p>以上代码等价于</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">||</span> <span class="o">[]</span>
</code></pre></div>
<p>空指针保护常用于初始化实例变量，看看下面这个类：</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">C</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="vi">@a</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">elements</span>
        <span class="vi">@a</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>使用空指针保护，可以更简练地重写以上这段代码：</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">C</span>
    <span class="k">def</span> <span class="nf">elements</span>
        <span class="vi">@a</span> <span class="o">||=</span> <span class="o">[]</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>上面的代码会在最后它要被访问的时候才进行初始化，这种惯用法被称为<strong>惰性实例变量(Lazy Instance Variable)</strong>。</p>

<h3 id="a.3-关于方法参数的技巧（tricks-with-method-arguments）">A.3 关于方法参数的技巧（Tricks with Method Arguments）</h3>

<h4 id="具名参数(named-arguments)">具名参数(Named Arguments)</h4>

<p>当在Ruby中调用方法时，你不得不按照特定的顺序输入参数。如果顺序错误，则会引入一个bug：</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
    <span class="c1">#...</span>
<span class="k">end</span>
<span class="n">login</span><span class="p">(</span><span class="s1">&#39;james&#39;</span><span class="p">,</span> <span class="s1">&#39;just doing some administration&#39;</span><span class="p">,</span> <span class="s1">&#39;123456&#39;</span><span class="p">)</span> <span class="c1">#bug</span>
</code></pre></div>
<p>当有一大串参数要输入时，这种错误非常常见。
Ruby 2.0 以后，可以使用关键字参数，Ruby 2.0可以使用Hash参数来解决这个问题。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">login</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;bill&#39;</span><span class="p">,</span> <span class="ss">message</span><span class="p">:</span> <span class="s1">&#39;just doing some administration&#39;</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="s1">&#39;123456&#39;</span><span class="p">)</span>
</code></pre></div>
<h4 id="参数数组和默认值(argument-arrays-and-default-values)">参数数组和默认值(Argument Arrays and Default Values)</h4>

<p>*操作符可以把多个参数收集到一个数组中；</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="n">args</span>
<span class="k">end</span>

<span class="n">my_method</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span> <span class="p">,</span> <span class="s1">&#39;three&#39;</span> <span class="p">)</span> <span class="c1"># =]]&gt; [1, &quot;2&quot;, &quot;three&quot;]</span>
</code></pre></div>
<p>Ruby 也支持如下参数默认值：</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;a default value&quot;</span> <span class="p">)</span>
    <span class="s2">&quot;</span><span class="si">#{</span><span class="n">x</span><span class="si">}</span><span class="s2"> and </span><span class="si">#{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
<span class="n">my_method</span><span class="p">(</span><span class="s2">&quot;a value&quot;</span> <span class="p">)</span> <span class="c1"># =&gt; &quot;a value and a default value&quot;</span>
</code></pre></div>
<h4 id="混合使用参数的惯用法(mixing-arguments-idioms)">混合使用参数的惯用法(Mixing Arguments Idioms)</h4>

<p>Ruby 2.0以前</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">hash</span><span class="p">)</span>
  <span class="n">lots</span> <span class="o">=</span> <span class="nb">hash</span><span class="o">[</span><span class="ss">:lots</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;default&quot;</span>
  <span class="n">args</span> <span class="o">=</span> <span class="nb">hash</span><span class="o">[</span><span class="ss">:args</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;another&quot;</span>
  <span class="n">hand</span> <span class="o">=</span> <span class="nb">hash</span><span class="o">[</span><span class="ss">:by_hand</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;annoying&quot;</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="k">end</span>
<span class="n">my_method</span> <span class="s2">&quot;with&quot;</span><span class="p">,</span> <span class="ss">lots</span><span class="p">:</span> <span class="s2">&quot;of&quot;</span><span class="p">,</span> <span class="ss">args</span><span class="p">:</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="ss">by_hand</span><span class="p">:</span> <span class="s2">&quot;form&quot;</span>
</code></pre></div>
<p>Ruby 2.0以后</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="ss">lots</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="ss">args</span><span class="p">:</span> <span class="s2">&quot;another&quot;</span><span class="p">,</span> <span class="ss">by_hand</span><span class="p">:</span> <span class="s2">&quot;annoying&quot;</span><span class="p">)</span>
  <span class="n">lots</span> <span class="o">=</span> <span class="nb">hash</span><span class="o">[</span><span class="ss">:lots</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;default&quot;</span>
  <span class="n">args</span> <span class="o">=</span> <span class="nb">hash</span><span class="o">[</span><span class="ss">:args</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;another&quot;</span>
  <span class="n">hand</span> <span class="o">=</span> <span class="nb">hash</span><span class="o">[</span><span class="ss">:by_hand</span><span class="o">]</span> <span class="o">||</span> <span class="s2">&quot;annoying&quot;</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="k">end</span>
<span class="n">my_method</span> <span class="s2">&quot;with&quot;</span><span class="p">,</span> <span class="ss">lots</span><span class="p">:</span> <span class="s2">&quot;of&quot;</span><span class="p">,</span> <span class="ss">args</span><span class="p">:</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="ss">by_hand</span><span class="p">:</span> <span class="s2">&quot;form&quot;</span>
</code></pre></div>
<h3 id="a.4-self-yield">A.4 Self Yield</h3>

<p>当给方法传入一个块时，你会期望这个方法通过yield对块进行回调。这种回调有一种有用的变形，就是对象可以把自身传给这个块。下面的例子来自于RubyGems包管理器。</p>

<h4 id="传统写法">传统写法</h4>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">spec</span> <span class="o">=</span> <span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="o">.</span><span class="n">new</span>
<span class="n">spec</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;My Gem name&quot;</span>
<span class="n">spec</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.0.1&quot;</span>
<span class="c1"># ...</span>
</code></pre></div>
<h4 id="self-yield-写法">Self Yield 写法</h4>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">spec</span> <span class="o">=</span> <span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
    <span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;My Gem name&quot;</span>
    <span class="n">s</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.0.1&quot;</span>
    <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div>
<h4 id="gem::specification-源代码">Gem::Specification 源代码</h4>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Gem</span>
    <span class="k">class</span> <span class="nc">Specification</span>
        <span class="k">def</span> <span class="nf">initialize</span>
            <span class="k">yield</span> <span class="nb">self</span> <span class="k">if</span> <span class="nb">block_given?</span>
            <span class="c1"># ...</span>
        <span class="k">end</span>
        <span class="c1">#...</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h4 id="来自-tap()-的例子">来自 tap() 的例子</h4>

<p>在Ruby中，长长的方法调用链很普遍</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="o">].</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;d&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="o">.</span><span class="n">upcase</span><span class="o">.</span><span class="n">next</span> <span class="c1"># =&gt; &quot;B&quot;</span>
</code></pre></div>
<p>但是某一步出错，你将不得不如下调试</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">temp</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;a&#39;</span> <span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">].</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;d&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">shift</span>
<span class="nb">puts</span> <span class="n">temp</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">upcase</span><span class="o">.</span><span class="n">next</span>
</code></pre></div>
<p>这非常笨拙；Ruby 1.9 中引入了 tap() 方法，我们可以这样做</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">[</span><span class="s1">&#39;a&#39;</span> <span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">].</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;d&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="o">.</span><span class="n">tap</span> <span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span><span class="o">.</span><span class="n">upcase</span><span class="o">.</span><span class="n">next</span>
</code></pre></div>
<p>老版本的 Ruby ，我们也可以很容易的实现一个</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Object</span>
    <span class="k">def</span> <span class="nf">tap</span>
        <span class="k">yield</span> <span class="nb">self</span>
        <span class="nb">self</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3 id="a.5-symbol#to_proc()-方法">A.5 Symbol#to_proc() 方法</h3>

<p>这种有点诡异的法术在Ruby程序员中很流行，请看下面的代码</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">names</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;bob&#39;</span> <span class="p">,</span> <span class="s1">&#39;bill&#39;</span> <span class="p">,</span> <span class="s1">&#39;heather&#39;</span> <span class="o">]</span>
<span class="n">names</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="nb">name</span><span class="o">|</span> <span class="nb">name</span><span class="o">.</span><span class="n">capitalize</span> <span class="p">}</span> <span class="c1"># =&gt; [&quot;Bob&quot;, &quot;Bill&quot;, &quot;Heather&quot;]</span>
</code></pre></div>
<p>更简洁的写法</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">names</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;bob&#39;</span> <span class="p">,</span> <span class="s1">&#39;bill&#39;</span> <span class="p">,</span> <span class="s1">&#39;heather&#39;</span> <span class="o">]</span>
<span class="n">names</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span> <span class="c1"># =&gt; [&quot;Bob&quot;, &quot;Bill&quot;, &quot;Heather&quot;]</span>
</code></pre></div>
<p>当&amp;操作符作用于一个对象时，它会调用该对象的to_proc方法，将其转化为一个proc对象。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Symbol</span>
    <span class="k">def</span> <span class="nf">to_proc</span>
        <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="法术手册">法术手册</h2>

<h3 id="法术集-(the-spells)">法术集 (The Spells)</h3>

<h4 id="数组参数(argument-array)">数组参数(Argument Array)</h4>

<p>把一组参数压入到一个数组中。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="n">args</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">arg</span><span class="o">|</span> <span class="n">arg</span><span class="o">.</span><span class="n">reverse</span> <span class="p">}</span>
<span class="k">end</span>
<span class="n">my_method</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span> <span class="p">,</span> <span class="s1">&#39;xyz&#39;</span> <span class="p">,</span> <span class="s1">&#39;123&#39;</span> <span class="p">)</span> <span class="c1"># =]]&gt; [&quot;cba&quot;, &quot;zyx&quot;, &quot;321&quot;]</span>
</code></pre></div>
<h4 id="环绕别名(around-alias)">环绕别名(Around Alias)</h4>

<p>从一个重新定义的方法中调用原始的、被重命名的版本。
三个基本步骤：
    1. 通过 alias 对原有方法定义一个别名
    2. 覆写原有方法
    3. 在该方法中调用别名方法
通过此方式可以改写原来方法，又不破坏原有功能。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">String</span>
    <span class="k">alias</span> <span class="ss">:old_reverse</span> <span class="ss">:reverse</span>
    <span class="k">def</span> <span class="nf">reverse</span>
        <span class="s2">&quot;x</span><span class="si">#{</span><span class="n">old_reverse</span><span class="si">}</span><span class="s2">x&quot;</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="s2">&quot;abc&quot;</span><span class="o">.</span><span class="n">reverse</span> <span class="c1"># =&gt; &quot;xcbax&quot;</span>
</code></pre></div>
<h4 id="白板(blank-slate)">白板(Blank Slate)</h4>

<p>移除一个对象中的所有方法，以便通过method<u>missing添加幽灵方法。主要目的避免原有类中的方法同新增方法产生冲突。注意以</u><u>开头的方法不能移除，比如</u><u>send</u>_等。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">C</span>
    <span class="k">def</span> <span class="nf">method_missing</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="s2">&quot;a Ghost Method&quot;</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">new</span>
<span class="n">obj</span><span class="o">.</span><span class="n">to_s</span> <span class="c1"># =&gt; &quot;#&lt;C:0x357258&gt;&quot;</span>

<span class="k">class</span> <span class="nc">C</span>
    <span class="nb">instance_methods</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
        <span class="n">undef_method</span> <span class="n">m</span> <span class="k">unless</span> <span class="n">m</span><span class="o">.</span><span class="n">to_s</span> <span class="o">=~</span> <span class="sr">/method_missing|respond_to?|^__/</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">obj</span><span class="o">.</span><span class="n">to_s</span> <span class="c1"># =&gt; &quot;a Ghost Method&quot;</span>
</code></pre></div>
<h4 id="类扩展(class-extension)">类扩展(Class Extension)</h4>

<p>通过向eigenclass中混入模块来定义类方法（是对象扩展的一个特例）。
扩展的方法存在于eigenclass类中，对类来说就是类方法，对对象实例来说就是单件方法。
提示：一个类，如class C具有双重身份。本身是个类，同时又是Class类的一个实例。类混入实际上是针对他作为Class类的一个实例对象的身份来进行的。
因此类扩展的方式一样适用于对象实例的扩展，那就是对象扩展了。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">C</span><span class="p">;</span> <span class="k">end</span>

<span class="k">module</span> <span class="nn">M</span>
    <span class="k">def</span> <span class="nf">my_method</span>
        <span class="s1">&#39;a class method&#39;</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="n">C</span>
    <span class="kp">include</span> <span class="n">M</span>
<span class="k">end</span>

<span class="n">C</span><span class="o">.</span><span class="n">my_method</span> <span class="c1"># =&gt; &quot;a class method&quot;</span>
</code></pre></div>
<h4 id="类扩展混入(class-extension-mixin)">类扩展混入(Class Extension Mixin)</h4>

<p>使一个模块可以通过钩子方法扩展它的包含者。
同上面基本类似，差别主要有：
  1. 通过 extend 方法，避免手工打开 eigenclass (即class &lt;&lt; C; end)操作。
  2. 通过 included 钩子方法触发。
  3. 可以同时添加实例方法跟类方法（这个例子没有演示）</p>

<p>基本编写方式：
  1. 定义一个模块，如 MyMixin
  2. 在 MyMixin 中定义一个内部模块，通常叫 ClassMethods，并定义一些方法，这些方法会成为包含者的类方法。
  3. 覆写 MyMixin#included() 方法，extend ClassMethods。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">M</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">base</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="no">ClassMethods</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">module</span> <span class="nn">ClassMethods</span>
        <span class="k">def</span> <span class="nf">my_method</span>
            <span class="s1">&#39;a class method&#39;</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">C</span>
    <span class="kp">include</span> <span class="n">M</span>
<span class="k">end</span>
<span class="n">C</span><span class="o">.</span><span class="n">my_method</span> <span class="c1"># =&gt; &quot;a class method&quot;</span>
</code></pre></div>
<h4 id="类实例变量(class-instance-variable)">类实例变量(Class Instance Variable)</h4>

<p>在一个 Class 对象的实例变量中存储类级别的状态。
核心提示：
  1. 这里的class C要当做Class类的一个实例对象看待。普通实例对象如何创建实例变量，类实例对象就如何创建实例变量。
  2. class ... end 实际上是在运行一段代码，不要用常规的关键字理解。
  3. 访问类实例变量，只能通过类方法（因为其 self 就是类名），或者加上类名前缀。</p>

<p>想一想如果我们运行时类名动态变化，如何处理，显然我们还有 eval 工具组（使用 instance<u>eval ，class</u>eval，eval 均可）</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">C</span>
    <span class="vi">@my_class_instance_variable</span> <span class="o">=</span> <span class="s2">&quot;some value&quot;</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">class_attribute</span>
        <span class="vi">@my_class_instance_variable</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">C</span><span class="o">.</span><span class="n">class_attribute</span> <span class="c1"># =&gt; &quot;some value&quot;</span>
</code></pre></div>
<h4 id="类宏(class-macro)">类宏(Class Macro)</h4>

<p>在类定义中使用一个类方法。
就是一个伪装成关键字的类方法。如attr_accessor :a, :b，类宏一般结合类扩展混入技术进行。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">C</span><span class="p">;</span> <span class="k">end</span>
<span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="n">C</span>
    <span class="k">def</span> <span class="nf">my_macro</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="s2">&quot;my_macro(</span><span class="si">#{</span><span class="n">arg</span><span class="si">}</span><span class="s2">) called&quot;</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">C</span>
    <span class="n">my_macro</span> <span class="ss">:x</span> <span class="c1"># =&gt; &quot;my_macro(x) called&quot;</span>
<span class="k">end</span>
</code></pre></div>
<h4 id="洁净室(clean-room)">洁净室(Clean Room)</h4>

<p>使用对象作为执行块的上下文环境
实际上就是通过 instance_eval 限定执行块的作用域。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">CleanRoom</span>
    <span class="k">def</span> <span class="nf">a_useful_method</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="k">end</span>
<span class="k">end</span>

<span class="no">CleanRoom</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">instance_eval</span> <span class="p">{</span> <span class="n">a_useful_method</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span> <span class="c1"># =&gt; 6</span>
</code></pre></div>
<h4 id="代码处理器(code-processor)">代码处理器(Code Processor)</h4>

<p>处理从外部获得的字符串代码</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">File</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="s2">&quot;a_file_containing_lines_of_ruby.txt&quot;</span> <span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">line</span><span class="o">.</span><span class="n">chomp</span><span class="si">}</span><span class="s2"> ==&gt; </span><span class="si">#{</span><span class="nb">eval</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>

<span class="c1">#&gt;&gt; 1 + 1 ==&gt; 2</span>
<span class="c1">#&gt;&gt; 3 * 2 ==&gt; 6</span>
<span class="c1">#&gt;&gt; Math.log10(100) ==&gt; 2.0</span>
</code></pre></div>
<h4 id="上下文探针(context-probe)">上下文探针(Context Probe)</h4>

<p>执行块来获取对象上下文中的信息。
其实就是通过 instance_eval 将对象内部的作用域暴露出来。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">C</span>
    <span class="k">def</span> <span class="nf">initialize</span>
        <span class="vi">@x</span> <span class="o">=</span> <span class="s2">&quot;a private instance variable&quot;</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">new</span>
<span class="n">obj</span><span class="o">.</span><span class="n">instance_eval</span> <span class="p">{</span> <span class="vi">@x</span> <span class="p">}</span> <span class="c1"># =&gt; &quot;a private instance variable&quot;</span>
</code></pre></div>
<h4 id="延迟执行(deferred-evaluation)">延迟执行(Deferred Evaluation)</h4>

<p>在proc或lambda中存储一段代码及其上下文，用于以后执行。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">C</span>
    <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
        <span class="vi">@my_code_capsule</span> <span class="o">=</span> <span class="n">block</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">execute</span>
        <span class="vi">@my_code_capsule</span><span class="o">.</span><span class="n">call</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">new</span>
<span class="n">obj</span><span class="o">.</span><span class="n">store</span> <span class="p">{</span> <span class="vg">$X</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">}</span>
<span class="vg">$X</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">obj</span><span class="o">.</span><span class="n">execute</span>
<span class="vg">$X</span> <span class="c1"># =&gt; 1</span>
</code></pre></div>
<h4 id="动态派发(dynamic-dispatcher)">动态派发(Dynamic Dispatcher)</h4>

<p>在运行时决定调用哪个方法
通过send发送消息，等价于方法调用。但通过send可以发送符号或字符串，灵活性大为增强。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">method_to_call</span> <span class="o">=</span> <span class="ss">:reverse</span>
<span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;abc&quot;</span>
<span class="n">obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">method_to_call</span><span class="p">)</span> <span class="c1"># =&gt; &quot;cba&quot;</span>
</code></pre></div>
<h4 id="动态方法(dynamic-method)">动态方法(Dynamic Method)</h4>

<p>在运行时才决定如何定义一个方法
动态方法还有一个特性：不会开启一个新的作用域。
我们知道def，module，class会开启新的作用域，扁平化作用域的办法就是用define_method，Module.new，Class.new等方法调用取代关键字。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">C</span>
<span class="k">end</span>

<span class="n">C</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
    <span class="n">define_method</span> <span class="ss">:my_method</span> <span class="k">do</span>
        <span class="s2">&quot;a dynamic method&quot;</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">new</span>
<span class="n">obj</span><span class="o">.</span><span class="n">my_method</span> <span class="c1"># =&gt; &quot;a dynamic method&quot;</span>
</code></pre></div>
<h4 id="动态代理(dynamic-proxy)">动态代理(Dynamic Proxy)</h4>

<p>把不能对应某个方法名的消息转发给另外一个对象。
method<u>missing结合send技术，另外可以辅助respond</u>to?谓词。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">MyDynamicProxy</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="vi">@target</span> <span class="o">=</span> <span class="n">target</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">method_missing</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
        <span class="s2">&quot;result: </span><span class="si">#{</span><span class="vi">@target</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">obj</span> <span class="o">=</span> <span class="no">MyDynamicProxy</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;a string&quot;</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">reverse</span> <span class="c1"># =&gt; &quot;result: gnirts a&quot;</span>
</code></pre></div>
<h4 id="扁平作用域(flat-scope)">扁平作用域(Flat Scope)</h4>

<p>使用闭包在两个作用域之间共享变量(以下用例不典型)</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">C</span>
    <span class="k">def</span> <span class="nf">an_attribute</span>
        <span class="vi">@attr</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">new</span>
<span class="n">a_variable</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># flatscope:</span>
<span class="n">obj</span><span class="o">.</span><span class="n">instance_eval</span> <span class="k">do</span>
    <span class="vi">@attr</span> <span class="o">=</span> <span class="n">a_variable</span>
<span class="k">end</span>

<span class="n">obj</span><span class="o">.</span><span class="n">an_attribute</span> <span class="c1"># =&gt; 100</span>
</code></pre></div>
<h4 id="幽灵方法(ghost-method)">幽灵方法(Ghost Method)</h4>

<p>响应一个没有关联方法的消息</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">C</span>
    <span class="k">def</span> <span class="nf">method_missing</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="nb">name</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">reverse</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">new</span>
<span class="n">obj</span><span class="o">.</span><span class="n">my_ghost_method</span> <span class="c1"># =&gt; &quot;dohtem_tsohg_ym&quot;</span>
</code></pre></div>
<h4 id="钩子方法(hook-method)">钩子方法(Hook Method)</h4>

<p>通过覆写某个特殊方法来截获对象模型事件。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vg">$INHERITORS</span> <span class="o">=</span> <span class="o">[]</span>
<span class="k">class</span> <span class="nc">C</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">inherited</span><span class="p">(</span><span class="n">subclass</span><span class="p">)</span>
        <span class="vg">$INHERITORS</span> <span class="o">&lt;&lt;</span> <span class="n">subclass</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">D</span> <span class="o">&lt;</span> <span class="n">C</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">E</span> <span class="o">&lt;</span> <span class="n">C</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">F</span> <span class="o">&lt;</span> <span class="n">E</span>
<span class="k">end</span>

<span class="vg">$INHERITORS</span> <span class="c1"># =&gt; [D, E, F]</span>
</code></pre></div>
<h4 id="内核方法(kernal-method)">内核方法(Kernal Method)</h4>

<p>在 Kernel 模块中定义一个方法，使之对所有对象都可用。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Kernel</span>
    <span class="k">def</span> <span class="nf">a_method</span>
        <span class="s2">&quot;a kernel method&quot;</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">a_method</span> <span class="c1"># =&gt; &quot;a kernel method&quot;</span>
</code></pre></div>
<h4 id="惰性实例变量(lazy-instance-variable)">惰性实例变量(Lazy Instance Variable)</h4>

<p>当第一次访问一个实例变量时才对之进行初始化。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">C</span>
    <span class="k">def</span> <span class="nf">attribute</span>
        <span class="vi">@attribute</span> <span class="o">||=</span> <span class="s2">&quot;some value&quot;</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">new</span>
<span class="n">obj</span><span class="o">.</span><span class="n">attribute</span> <span class="c1"># =&gt; &quot;some value&quot;</span>
</code></pre></div>
<h4 id="拟态方法(mimic-method)">拟态方法(Mimic Method)</h4>

<p>把一个方法伪装成另外一种语言构件。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">BaseClass</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="nb">name</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="p">?</span> <span class="nb">String</span> <span class="p">:</span> <span class="no">Object</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">C</span> <span class="o">&lt;</span> <span class="no">BaseClass</span> <span class="s2">&quot;string&quot;</span> <span class="c1"># a method that looks like a class</span>
    <span class="kp">attr_accessor</span> <span class="ss">:an_attribute</span> <span class="c1"># 伪装成关键字的方法</span>
<span class="k">end</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">new</span>
<span class="n">obj</span><span class="o">.</span><span class="n">an_attribute</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># 伪装成属性的方法</span>
</code></pre></div>
<h4 id="猴子打补丁(monkeypatch)">猴子打补丁(Monkeypatch)</h4>

<p>修改已有类的特性。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">&quot;abc&quot;</span><span class="o">.</span><span class="n">reverse</span> <span class="c1"># =&gt; &quot;cba&quot;</span>
<span class="k">class</span> <span class="nc">String</span>
    <span class="k">def</span> <span class="nf">reverse</span>
        <span class="s2">&quot;override&quot;</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="s2">&quot;abc&quot;</span><span class="o">.</span><span class="n">reverse</span> <span class="c1"># =&gt; &quot;override&quot;</span>
</code></pre></div>
<h4 id="有名参数(named-arguments)">有名参数(Named Arguments)</h4>

<p>把方法参数收集到一个哈希表中，以便通过名字访问（Ruby2.0+直接支持）。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">args</span><span class="o">[</span><span class="ss">:arg2</span><span class="o">]</span>
<span class="k">end</span>

<span class="n">my_method</span><span class="p">(</span><span class="ss">:arg1</span> <span class="o">=&gt;</span> <span class="s2">&quot;A&quot;</span> <span class="p">,</span> <span class="ss">:arg2</span> <span class="o">=&gt;</span> <span class="s2">&quot;B&quot;</span> <span class="p">,</span> <span class="ss">:arg3</span> <span class="o">=&gt;</span> <span class="s2">&quot;C&quot;</span><span class="p">)</span> <span class="c1"># =&gt; &quot;B&quot;</span>
</code></pre></div>
<h4 id="命名空间(namespace)">命名空间(Namespace)</h4>

<p>在一个模块中定义常量，以防止命名冲突。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">MyNamespace</span>
    <span class="k">class</span> <span class="nc">Array</span>
        <span class="k">def</span> <span class="nf">to_s</span>
            <span class="s2">&quot;my class&quot;</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="nb">Array</span><span class="o">.</span><span class="n">new</span> <span class="c1"># =&gt; []</span>
<span class="no">MyNamespace</span><span class="o">::</span><span class="nb">Array</span><span class="o">.</span><span class="n">new</span> <span class="c1"># =&gt; my class</span>
</code></pre></div>
<h4 id="空指针保护(nil-guard)">空指针保护(Nil Guard)</h4>

<p>用“或”操作符覆写一个空应用。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">x</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">||</span> <span class="s2">&quot;a value&quot;</span> <span class="c1"># =&gt; &quot;a value&quot;</span>
</code></pre></div>
<h4 id="对象扩展(object-extension)">对象扩展(Object Extension)</h4>

<p>通过给一个对象 eigenclass 混入模块来定义单件方法。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">obj</span> <span class="o">=</span> <span class="no">Object</span><span class="o">.</span><span class="n">new</span>

<span class="k">module</span> <span class="nn">M</span>
    <span class="k">def</span> <span class="nf">my_method</span>
        <span class="s1">&#39;a singleton method&#39;</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="n">obj</span>
    <span class="kp">include</span> <span class="n">M</span>
<span class="k">end</span>
<span class="n">obj</span><span class="o">.</span><span class="n">my_method</span> <span class="c1"># =&gt; &quot;a singleton method&quot;</span>
</code></pre></div>
<h4 id="打开类(open-class)">打开类(Open Class)</h4>

<p>修改已有的类</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">String</span>
    <span class="k">def</span> <span class="nf">my_string_method</span>
        <span class="s2">&quot;my method&quot;</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="s2">&quot;abc&quot;</span><span class="o">.</span><span class="n">my_string_method</span> <span class="c1"># =&gt; &quot;my method&quot;</span>
</code></pre></div>
<h4 id="模式派发(pattern-dispatch)">模式派发(Pattern Dispatch)</h4>

<p>根据名字来选择需要调用的方法。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vg">$x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">class</span> <span class="nc">C</span>
    <span class="k">def</span> <span class="nf">my_first_method</span>
        <span class="vg">$x</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">my_second_method</span>
        <span class="vg">$x</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">new</span>
<span class="n">obj</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">to_s</span> <span class="o">=~</span> <span class="sr">/^my_/</span>
<span class="k">end</span>
<span class="vg">$x</span> <span class="c1"># =&gt; 3</span>
</code></pre></div>
<h4 id="沙盒(sandbox)">沙盒(Sandbox)</h4>

<p>在一个安全的环境中执行为授信的代码</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">sandbox</span><span class="p">(</span><span class="o">&amp;</span><span class="n">code</span><span class="p">)</span>
    <span class="nb">proc</span> <span class="p">{</span>
        <span class="vg">$SAFE</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">yield</span>
    <span class="p">}</span><span class="o">.</span><span class="n">call</span>
<span class="k">end</span>

<span class="k">begin</span>
    <span class="n">sandbox</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">delete</span> <span class="s1">&#39;a_file&#39;</span> <span class="p">}</span>
<span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">ex</span>
    <span class="n">ex</span> <span class="c1"># =&gt; #&lt;SecurityError: Insecure operation `delete&#39; at level 2&gt;</span>
<span class="k">end</span>
</code></pre></div>
<h4 id="作用域门(scope-gate)">作用域门(Scope Gate)</h4>

<p>用class，module或def关键字来隔离作用域</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">defined?</span> <span class="n">a</span> <span class="c1"># =&gt; &quot;local-variable&quot;</span>

<span class="k">module</span> <span class="nn">MyModule</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">defined?</span> <span class="n">a</span> <span class="c1"># =&gt; nil</span>
    <span class="n">defined?</span> <span class="n">b</span> <span class="c1"># =&gt; &quot;local-variable&quot;</span>
<span class="k">end</span>

<span class="n">defined?</span> <span class="n">a</span> <span class="c1"># =&gt; &quot;local-variable&quot;</span>
<span class="n">defined?</span> <span class="n">b</span> <span class="c1"># =&gt; nil</span>
</code></pre></div>
<h4 id="self-yield">Self Yield</h4>

<p>把self传给当前块</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Person</span>
    <span class="kp">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:surname</span>
    <span class="k">def</span> <span class="nf">initialize</span>
        <span class="k">yield</span> <span class="nb">self</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">joe</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span>
    <span class="nb">p</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Joe&#39;</span>
    <span class="nb">p</span><span class="o">.</span><span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;Smith&#39;</span>
<span class="k">end</span>
</code></pre></div>
<h4 id="共享作用域(shared-scope)">共享作用域(Shared Scope)</h4>

<p>在同一个扁平作用域的多个上下文中共享变量。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">lambda</span> <span class="p">{</span>
    <span class="n">shared</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
        <span class="n">define_method</span> <span class="ss">:counter</span> <span class="k">do</span>
            <span class="n">shared</span>
        <span class="k">end</span>
        <span class="n">define_method</span> <span class="ss">:down</span> <span class="k">do</span>
            <span class="n">shared</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="p">}</span><span class="o">.</span><span class="n">call</span>

<span class="n">counter</span> <span class="c1"># =&gt; 10</span>
<span class="mi">3</span><span class="o">.</span><span class="n">times</span> <span class="p">{</span> <span class="n">down</span> <span class="p">}</span>
<span class="n">counter</span> <span class="c1"># =&gt; 7</span>
</code></pre></div>
<h4 id="单件方法(singleton-method)">单件方法(Singleton Method)</h4>

<p>在一个对象上定义一个方法，其实是在该对象eigenclass中定义了一个实例方法。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;abc&quot;</span>

<span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="n">obj</span>
    <span class="k">def</span> <span class="nf">my_singleton_method</span>
        <span class="s2">&quot;x&quot;</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">obj</span><span class="o">.</span><span class="n">my_singleton_method</span> <span class="c1"># =&gt; &quot;x&quot;</span>
</code></pre></div>
<h4 id="代码字符串(string-of-code)">代码字符串(String of Code)</h4>

<p>执行一段表示 Ruby 代码的字符串。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">my_string_of_code</span> <span class="o">=</span> <span class="s2">&quot;1 + 1&quot;</span>
<span class="nb">eval</span><span class="p">(</span><span class="n">my_string_of_code</span><span class="p">)</span> <span class="c1"># =&gt; 2</span>
</code></pre></div>
<h4 id="符号到proc(symbol-to-proc)">符号到Proc(Symbol To Proc)</h4>

<p>把一个符号转换为调用单个方法的代码块。</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="o">].</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:even?</span><span class="p">)</span> <span class="c1"># =&gt; [false, true, false, true]</span>
</code></pre></div>
    </article>

    <div class="row-fluid">
        <ul class="list-inline">
            <li><i class="glyphicon glyphicon-folder-open"></i></li>
            
            
    
    <li class="tag"><a href="/categories/ruby.html">Ruby<span>1</span></a></li>
    

        </ul>
        <ul class="list-inline">
            <li><i class="glyphicon glyphicon-tags"></i></li>
            
            
    
    <li class="tag"><a href="/tags/ruby.html">Ruby<span>5</span></a></li>
    

    
    <li class="tag"><a href="/tags/metaprogramming.html">元编程<span>2</span></a></li>
    

    
    <li class="tag"><a href="/tags/dsl.html">DSL<span>2</span></a></li>
    

        </ul>
    </div>

    <div class="row-fluid">
        <ul class="pagination pull-right">
            
            <li class="prev"><a href="/2014/08/18/angular-injector-analyze.html" title="抽丝剥茧——AngularJS Injector分析">&larr; 上一篇</a></li>
            
            <li><a href="http://jameszhan.github.io">Archive</a></li>
            
            <li class="next"><a href="/2014/09/10/lambda-church-number.html" title="Lambda演算之自然数">下一篇 &rarr;</a>
            </li>
            
        </ul>
    </div>
</div>

    </div>

    <div class="col-md-3">
        <div class="box">
    <h2 class="title">
        <span class="icon-text"><i class="glyphicon glyphicon-tags"></i>
            <a href="/categories/index.html">分类</a></span>
    </h2>
    <ul class="list-inline">
        
        
    
    <li class="tag"><a href="/categories/algorithm.html">Algorithm <span>5</span></a></li>
    

    
    <li class="tag"><a href="/categories/javascript.html">JavaScript <span>2</span></a></li>
    

    
    <li class="tag"><a href="/categories/linux.html">Linux <span>1</span></a></li>
    

    
    <li class="tag"><a href="/categories/ruby.html">Ruby <span>1</span></a></li>
    

    
    <li class="tag"><a href="/categories/pdl.html">程序设计语言 <span>6</span></a></li>
    

    
    <li class="tag"><a href="/categories/github.html">GitHub <span>1</span></a></li>
    

    
    <li class="tag"><a href="/categories/osx.html">OS X <span>1</span></a></li>
    

    </ul>
</div>

<div class="box">
    <h2 class="title">
        <span class="icon-text"><i class="glyphicon glyphicon-tags"></i>
            <a href="/tags/index.html">标签</a>
        </span>
    </h2>
    <ul class="list-inline">
        
        
    
    <li class="tag"><a href="/tags/algorithm.html">Algorithm <span>5</span></a></li>
    

    
    <li class="tag"><a href="/tags/c.html">C <span>2</span></a></li>
    

    
    <li class="tag"><a href="/tags/python.html">Python <span>1</span></a></li>
    

    
    <li class="tag"><a href="/tags/backtracking.html">回溯法 <span>3</span></a></li>
    

    
    <li class="tag"><a href="/tags/ruby.html">Ruby <span>5</span></a></li>
    

    
    <li class="tag"><a href="/tags/clojure.html">Clojure <span>5</span></a></li>
    

    
    <li class="tag"><a href="/tags/fp.html">函数式编程 <span>6</span></a></li>
    

    
    <li class="tag"><a href="/tags/javascript.html">JavaScript <span>8</span></a></li>
    

    
    <li class="tag"><a href="/tags/object_model.html">对象模型 <span>2</span></a></li>
    

    
    <li class="tag"><a href="/tags/linux.html">Linux <span>1</span></a></li>
    

    
    <li class="tag"><a href="/tags/shell.html">Shell <span>1</span></a></li>
    

    
    <li class="tag"><a href="/tags/angular_js.html">AngularJ <span>1</span></a></li>
    

    
    <li class="tag"><a href="/tags/metaprogramming.html">元编程 <span>2</span></a></li>
    

    
    <li class="tag"><a href="/tags/dsl.html">DSL <span>2</span></a></li>
    

    
    <li class="tag"><a href="/tags/lambda.html">Lambda <span>5</span></a></li>
    

    
    <li class="tag"><a href="/tags/pdl.html">程序设计语言 <span>5</span></a></li>
    

    
    <li class="tag"><a href="/tags/codestyle.html">代码风格 <span>1</span></a></li>
    

    
    <li class="tag"><a href="/tags/java.html">Java <span>2</span></a></li>
    

    
    <li class="tag"><a href="/tags/swift.html">Swift <span>1</span></a></li>
    

    
    <li class="tag"><a href="/tags/github.html">GitHub <span>1</span></a></li>
    

    
    <li class="tag"><a href="/tags/osx.html">OS X <span>1</span></a></li>
    

    
    <li class="tag"><a href="/tags/php.html">Php <span>1</span></a></li>
    

    </ul>
</div>
    </div>
</div>

<div class="container">
<footer>
    <hr/>
    <div class="row footer-content">

        <div class="col-md-3">
            <ul class="contact-list">
                <li>詹子知</li>
                <li>Full Stack Engineer</li>
                <li><a href="mailto:zhiqiangzhan@gmail.com">zhiqiangzhan@gmail.com</a></li>
            </ul>
        </div>

        <div class="col-md-3">
            <ul class="social-media-list">
                
                <li>
                    <a href="https://github.com/jameszhan">
              <span class="icon icon--github">
                <svg viewBox="0 0 16 16">
                    <path fill="#828282"
                          d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

                        <span class="username">jameszhan</span>
                    </a>
                </li>
                

                
                <li>
                    <a href="https://twitter.com/jameszhan">
              <span class="icon icon--twitter">
                <svg viewBox="0 0 16 16">
                    <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

                        <span class="username">jameszhan</span>
                    </a>
                </li>
                
                <li>
                    <a href="http://weibo.com/zizhizhan">
              <span class="icon icon--weibo">
               <svg viewBox="0, 0, 300, 300">
                   <path d="M196.802 39.964c-8.656 3.787-10.64 12.803-4.328 19.115 3.066 3.066 5.951 3.607 18.574 3.607 17.673 0 29.575 4.688 38.592 15.148 11 12.443 12.263 16.23 12.263 38.952 0 20.197 0 20.558 4.688 23.263 10.82 6.131 18.034-1.443 20.558-21.64 3.246-26.329-12.443-56.986-36.066-71.052-15.509-9.016-42.018-12.623-54.281-7.393zm-88.724 33.542c-20.198 7.213-39.674 21.099-60.592 43.46-49.592 52.658-46.346 102.791 8.295 129.48 56.805 27.771 133.267 18.574 174.924-21.099 31.198-29.575 27.411-66.724-8.115-79.347-6.312-2.164-8.296-3.787-7.394-5.771 3.246-7.934 4.328-17.131 2.525-22.541-5.591-17.132-25.968-21.099-56.264-10.82l-12.083 4.147 1.082-12.082c1.263-14.246-1.803-22.001-10.279-26.329-7.033-3.607-20.558-3.246-32.099.902zm50.133 69.789c26.869 7.394 43.28 23.624 43.28 42.919 0 21.46-19.116 40.756-50.133 51.035-16.591 5.41-47.428 6.492-62.576 2.344-28.673-8.115-44.903-23.984-44.903-44.362 0-11.181 4.869-20.919 15.509-30.837 9.918-9.377 17.492-13.886 32.099-18.755 22.001-7.393 45.625-8.295 66.724-2.344zm-56.806 17.492c-18.213 8.476-27.951 21.46-27.951 37.69 0 14.788 6.492 24.886 20.738 32.46 11 5.951 31.198 5.41 43.461-.901 15.689-8.296 25.968-23.624 25.968-38.592-.181-12.263-11.001-26.87-23.804-32.099-10.279-4.328-27.592-3.607-38.412 1.442zm13.165 33.903c1.262 1.262 2.164 4.328 2.164 7.033 0 9.017-15.148 16.411-21.28 10.279-3.426-3.426-2.524-11.902 1.443-15.869 3.967-3.968 14.246-4.869 17.673-1.443zm85.298-117.758c-8.296 8.296-2.705 18.214 10.459 18.214 11.361 0 16.41 5.771 16.41 18.755 0 8.115.722 10.459 3.968 12.623 9.738 6.853 17.673-.721 17.673-16.771 0-19.656-14.067-34.444-34.084-35.887-9.016-.721-11.18-.18-14.426 3.066z"/>
               </svg>
              </span>

                        <span class="username">zizhizhan</span>
                    </a>
                </li>
                <li>
                    <a href="http://www.zhihu.com/people/james_zhan">
              <span class="icon icon--zhihu">
                <svg viewBox="0, 0, 300, 300">
                    <path d="M78.172 153.638s-.038-9.983-3.211-9.983h-22.119c.736-11.455.928-21.811.928-31.058h21.629s.833-9.538-3.626-9.428h-37.415c1.474-5.546 3.328-11.273 5.546-17.193 0 0-10.175 0-13.644 9.125-1.432 3.768-5.584 18.239-12.976 33.026 2.491-.267 10.725-.493 15.574-9.387.893-2.483 1.063-2.815 2.172-6.143h12.201c0 4.436.064 10.566-.3 17.956 0 7.04-.205 10.32-.41 13.102h-22.105c-4.963 0-6.578 9.983-6.578 9.983h27.73c-1.855 21.075-11.838 38.64-29.948 52.687 2.954 2.953 17.687-.107 21.562-3.999 0 0 9.715-8.828 15.042-29.277 7.019 8.138 12.936 15.348 17.747 21.629 2.219 2.962 4.992 6.101 4.992 6.101s3.423-11.642-.448-17.18c-3.204-3.773-11.944-14.058-15.635-17.76l-6.102 4.992c1.846-5.908 2.957-11.648 3.329-17.193h26.065zm5.546 39.903l9.902.002 3.173 11.08s15.187-11.08 17.848-11.08c2.662 0 10.402-.002 10.402-.002h10.538v-91.968h-51.863v91.968zm10.538-81.985h30.787v72.004h-11.81l-11.983 7.663-1.959-7.648-5.035-.015v-72.004zm149.188 25.443l8.875 6.656c9.61-11.828 16.444-20.883 20.52-27.176 0 0-7.06-6.453-12.533-1.819-2.314 3.729-9.097 13.839-16.862 22.339zm-44.369.556c-.372-.367-.922-1.11-1.663-2.219-7.028-9.609-10.173-15.126-14.325-18.931-4.153-3.804-12.295 1.183-12.295 1.183 4.436 5.546 9.613 12.756 15.529 21.63 1.47 2.219 2.58 3.882 3.327 4.992l9.427-6.655zm89.292 11.769c-9.129 0-60.451.431-60.451.431v-46.586c2.218 0 5.73-.181 10.537-.554 18.856-1.11 32.348-1.847 40.486-2.219 0 0 5.634-12.541-.274-15.426-4.26 0-4.951 1.705-10.679 2.112-2.364.168-76.205 7.606-107.177 8.322.735 4.071 3.385 6.962 7.193 9.114 7.202 1.574 10.554.688 22.755.315 11.455-.736 20.146-1.109 26.066-1.109v46.031h-61.561s2.095 10.538 10.233 10.538h51.328v32.722c0 6.446-5.16 10.144-11.291 9.743-6.492.054-12.029-.529-19.227-.832.921 1.831 2.919 6.636 8.908 10.071 4.554 2.22 7.458 3.033 12.002 3.033 13.631 0 21.062-7.969 20.701-20.907v-33.829h56.438c4.469-.001 4.013-10.97 4.013-10.97z"/>
                </svg>
              </span>
                        <span class="username">james_zhan</span>
                    </a>
                </li>
                <li>
                    <a href="http://www.baidu.com/p/zhiqiangzhan">
              <span class="icon icon--baidu">
                <svg viewBox="0, 0, 300, 300">
                    <path d="M108.462 11.538c-3.385 1.231-8.616 4.924-11.847 8.462-7.846 8.769-11.23 19.385-11.077 34.769 0 10.462.77 13.846 4.924 22.616 8.769 19.077 26.153 25.077 40 13.846 17.692-14.308 20.923-48.154 6.769-68.462-3.693-5.231-16.769-13.692-20.923-13.538-.923.154-4.462 1.077-7.846 2.307zm82.769 6.462c-5.846 1.231-19.539 14.923-23.846 23.846-7.385 15.077-7.077 34.308.769 46.154 6.923 10.308 22.461 14.615 34.615 9.538 16.308-6.769 28.769-31.692 24.923-49.23-4.461-19.539-21.384-33.539-36.461-30.308zm-147.385 58.154c-8.154 2.769-17.077 13.077-20.154 22.923-6.154 20.154-3.846 36.615 6.923 48.923 7.847 8.769 13.077 11.077 24.616 10.154 12.307-.923 20.154-6.308 25.846-18 3.692-7.385 4.154-10.308 4.154-22.462 0-11.077-.616-15.077-3.385-20.154-5.077-9.846-10.461-15.384-19.077-19.692-9.077-4.615-10.461-4.615-18.923-1.692zm185.692 21.692c-11.538 5.846-17.23 18.923-17.23 39.692 0 15.385 2 22.616 7.846 29.385 6.461 7.385 16 10.615 28.154 9.692 11.23-.923 17.23-4 22.154-11.077 5.076-7.384 6.461-13.846 6.461-29.538 0-12.462-.461-15.077-4.308-22.308-6.307-12-14.461-17.384-27.692-18-7.385-.307-11.692.308-15.385 2.154zm-98.769 30c-10.154 4.616-16.154 9.692-22.923 19.539-9.077 13.23-17.538 22.307-36 38.307-28 24.154-33.846 33.231-34 52-.308 22.616 12.769 42.616 31.077 47.846 10.615 3.077 38.154 2.308 58.769-1.846 16-3.077 32-2.307 51.539 2.616 19.692 4.923 41.538 4.923 52.769 0 21.231-9.539 32.154-38.616 23.231-62.616-2.462-6.615-5.539-10.769-12.616-17.384-22.153-20.462-47.23-46.308-55.23-57.077-8.923-12-18.154-19.846-27.231-22.769-8.154-2.77-21.539-2.154-29.385 1.384zm4.616 42.923c2 1.231 2.307 8.616 2.769 47.693l.461 46.153h-18.307c-22.462 0-31.231-2.307-39.077-10.307-7.231-7.385-8.923-12.154-8.923-24.308 0-11.846 1.692-16.923 8.154-23.538 8.153-8.616 14.615-11.077 28.769-11.077h12.307v-26.154h5.847c3.077 0 6.769.769 8 1.538zm30.769 48.769c0 28 .154 28.154 16.461 28.154h11.231v-49.23h18.769l-.615 29.384c-.615 37.231.923 35.231-27.692 35.231-21.539 0-26-1.231-31.846-8.615-2.924-3.847-3.231-6-3.231-29.847 0-14.153.461-26.153 1.077-26.615.461-.615 4.307-1.077 8.461-1.077h7.385v22.615zm-67.385-7.23c-8.615 5.23-11.692 16.615-7.384 26.923 3.077 7.077 9.692 10.307 20.615 9.692l8.769-.461v-38.462l-8.461-.462c-6.308-.307-9.693.462-13.539 2.77z"/>
                </svg>
              </span>
                        <span class="username">zhiqiangzhan</span>
                    </a>
                </li>
            </ul>
        </div>

        <div class="col-md-6">
            <p class="text">资深码农，技术兴趣广泛，好读书，求甚解</p>
        </div>
    </div>

</footer>
</div>

<div class="analytics">
<!-- 百度统计开始 -->
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F4a9354184739dfe6490722e2ad838394' type='text/javascript'%3E%3C/script%3E"));
</script>
<!-- 百度统计结束 -->
</div>

<div class="modal fade" id="globalModal" tabindex="-1" role="dialog" aria-labelledby="globalModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
        </div>
    </div>
</div>


</body>

</html>