<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>尽管扯淡</title>
    <description>资深码农，程序设计语言控</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Tue, 27 Nov 2018 07:39:29 +0000</pubDate>
    <lastBuildDate>Tue, 27 Nov 2018 07:39:29 +0000</lastBuildDate>
    <generator>Jekyll v3.7.4</generator>
    
      <item>
        <title>理解 Ruby 中的变量作用域</title>
        <description>&lt;p&gt;在冯·诺依曼计算机体系结构的内存中，变量的属性可以视为一个六元组：（名字，地址，值，类型，生命期，作用域）。地址属性具有明显的冯·诺依曼体系结构的色彩，代表变量所关联的存储器地址。类型规定了变量的取值范围和可能的操作。生命期表示变量与某个存储区地址绑定的过程。根据生命期的不同，变量可以被分为四类：静态、栈动态、显式堆动态和隐式堆动态。作用域表征变量在语句中的可见范围，主要分为静态作用域和动态作用域两种。&lt;/p&gt;

&lt;p&gt;作用域是所有编程语言都需要了解的基础概念之一，它是是为了解决开发过程中变量名冲突发展起来的概念。&lt;/p&gt;

&lt;h2 id=&quot;ruby-变量&quot;&gt;&lt;strong&gt;Ruby&lt;/strong&gt; 变量&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Ruby&lt;/strong&gt; 中的变量主要有以下四种。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;局部变量（a_var）: 可见范围取决于作用域。&lt;/li&gt;
  &lt;li&gt;全局变量（$a_var）：在程序的任何地方可见。&lt;/li&gt;
  &lt;li&gt;实例变量（@a_var）：对定义该变量的类的实例及其实例方法可见，但不可以直接被类使用。&lt;/li&gt;
  &lt;li&gt;类变量（@@a_var）：仅对定义该类变量的类及其子类可见。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;局部变量&quot;&gt;局部变量&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Kernel#local_variables&lt;/code&gt; 方法可以方便我们查看当前作用域中定义了哪些变量。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a_var&lt;/span&gt;              &lt;span class=&quot;c1&quot;&gt;# NameError，需要先声明才可以访问&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;rescue&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;NameError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;locals is &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;undefined local variable or method `a_var' for main:Object
locals is [:e, :_oh, :_ih, :title]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Ruby&lt;/strong&gt; 语言是赋值即变量声明的语言，他没有与 &lt;strong&gt;JavaScript&lt;/strong&gt; 语言的 &lt;code class=&quot;highlighter-rouge&quot;&gt;var x&lt;/code&gt; 和 &lt;strong&gt;Java&lt;/strong&gt; 的 &lt;code class=&quot;highlighter-rouge&quot;&gt;String str&lt;/code&gt; 相当的变量声明。只能通过赋值语句来声明变量，但是却不需要该赋值语句真正被执行。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;a_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a_var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;nil?&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;true
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;scope-gates&quot;&gt;Scope Gates&lt;/h3&gt;

&lt;p&gt;每个 &lt;strong&gt;Ruby&lt;/strong&gt; 作用域包含一组绑定，并且不同的作用域之间被 &lt;strong&gt;Scope Gate&lt;/strong&gt; 分割开来。&lt;strong&gt;Scope Gate&lt;/strong&gt; 的作用是关闭前一个作用域，同时打开一个新的作用域。&lt;strong&gt;Ruby&lt;/strong&gt; 中使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;class&lt;/code&gt;，&lt;code class=&quot;highlighter-rouge&quot;&gt;module&lt;/code&gt; 或 &lt;code class=&quot;highlighter-rouge&quot;&gt;def&lt;/code&gt; 关键字来隔离作用域，也就是充当 &lt;strong&gt;Scope Gate&lt;/strong&gt;。&lt;/p&gt;

&lt;p&gt;先来看个例子：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;change_x&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;change_x&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sx&quot;&gt;%%file change_x.py

x = 1
def change_x():
  x = 2

change_x()
print(&quot;x = {0}&quot;.format(x))
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Writing change_x.py
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;`python change_x.py`&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;x = 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如你所料，&lt;code class=&quot;highlighter-rouge&quot;&gt;x&lt;/code&gt; 的值并没有真正被修改。这和 &lt;strong&gt;Python&lt;/strong&gt; 表现是一致的，但是其深层的原理却有比较大的差别。&lt;/p&gt;

&lt;p&gt;在 &lt;strong&gt;Python&lt;/strong&gt; 中，&lt;code class=&quot;highlighter-rouge&quot;&gt;change_x&lt;/code&gt; 是一个闭包，它可以看到外部的 &lt;code class=&quot;highlighter-rouge&quot;&gt;x&lt;/code&gt;，之所以没有修改成功，是因为 &lt;code class=&quot;highlighter-rouge&quot;&gt;change_x&lt;/code&gt; 重新定义了本地变量 &lt;code class=&quot;highlighter-rouge&quot;&gt;x&lt;/code&gt;，并把 &lt;code class=&quot;highlighter-rouge&quot;&gt;2&lt;/code&gt; 赋值给了 &lt;code class=&quot;highlighter-rouge&quot;&gt;x&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;在 &lt;strong&gt;Ruby&lt;/strong&gt; 中，&lt;code class=&quot;highlighter-rouge&quot;&gt;change_x&lt;/code&gt; 则是打开了一个全新的作用域，它是无法访问到外部的变量 &lt;code class=&quot;highlighter-rouge&quot;&gt;x&lt;/code&gt; 的。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sx&quot;&gt;%%file check_x.py

x = 1
def check_x():
  print(&quot;I can see x = {0} in check_x.&quot;.format(x))

check_x()
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Writing check_x.py
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;`python check_x.py`&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;I can see x = 1 in check_x.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;我们再来看一个多层 &lt;strong&gt;Scope Gate&lt;/strong&gt; 的例子：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;main0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'main0'&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;MyModule&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;module1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'module1'&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;enter MyModule locals: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  
  &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MyClass&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;class2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'class2'&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;enter MyClass locals: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;my_method&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;method_3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'method3'&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;my_method locals: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;exit MyClass locals: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;exit MyModule locals: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    
&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;MyModule&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MyClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;my_method&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;my_method&lt;/span&gt;
  
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;main locals: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;enter MyModule locals: [:module1]
enter MyClass locals: [:class2]
exit MyClass locals: [:class2]
exit MyModule locals: [:module1]
my_method locals: [:method_3]
my_method locals: [:method_3]
main locals: [:main0, :obj, :_i7, :_7, :_i6, :_6, :_i5, :_5, :_i4, :_4, :_i3, :_3, :x, :_i2, :_2, :a_var, :_i, :_ii, :_iii, :_, :__, :___, :_i1, :_1, :e, :_oh, :_ih, :title]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;容易看出程序打开了五个独立的作用域&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;顶级作用域（&lt;code class=&quot;highlighter-rouge&quot;&gt;main0&lt;/code&gt; 所在的作用域）&lt;/li&gt;
  &lt;li&gt;进入 &lt;code class=&quot;highlighter-rouge&quot;&gt;MyModule&lt;/code&gt; 时创建的作用域&lt;/li&gt;
  &lt;li&gt;进入 &lt;code class=&quot;highlighter-rouge&quot;&gt;MyClass&lt;/code&gt; 时创建的作用域&lt;/li&gt;
  &lt;li&gt;第一次调用 &lt;code class=&quot;highlighter-rouge&quot;&gt;my_method()&lt;/code&gt; 方法时创建的一个作用域&lt;/li&gt;
  &lt;li&gt;第二次调用 &lt;code class=&quot;highlighter-rouge&quot;&gt;my_method()&lt;/code&gt; 方法时创建的一个作用域&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;如何知道每次调用同一方法时会重新创建新的作用域而不是重用已有的，我们通过一个程序来验证。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MyClass&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;my_method&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;my_method locals: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;binding&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;MyClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;binding1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;my_method&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;binding2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;my_method&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;v in binding1 is &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;binding1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;local_variable_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;v in binding2 is &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;binding2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;local_variable_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;binding1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;local_variable_set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:v2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;binding1 variables is &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;binding1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;binding2 variables is &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;binding2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;my_method locals: [:v]
my_method locals: [:v]
v in binding1 is 25
v in binding2 is 36
binding1 variables is [:v2, :v]
binding2 variables is [:v]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;class&lt;/code&gt; / &lt;code class=&quot;highlighter-rouge&quot;&gt;module&lt;/code&gt; 与 &lt;code class=&quot;highlighter-rouge&quot;&gt;def&lt;/code&gt; 之间还有一点微妙的差别，在类和模块定义中的代码会被立即执行，相反，方法定义中的代码只有在方法被调用的时候才会被执行。&lt;/p&gt;

&lt;h3 id=&quot;顶级上下文top-level-context&quot;&gt;顶级上下文（Top Level Context）&lt;/h3&gt;

&lt;p&gt;当开始运行 &lt;strong&gt;Ruby&lt;/strong&gt; 程序时，&lt;strong&gt;Ruby&lt;/strong&gt; 虚拟机会创建一个名为 &lt;code class=&quot;highlighter-rouge&quot;&gt;main&lt;/code&gt; 的对象作为当前对象，这个对象被称为顶级上下文，这个名字的由来是因为这时处在调用栈的顶层，这时要么还没调用任何方法，要么调用的所有方法都已经返回了。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;main
Object
[:_i9, :_9, :binding1, :binding2, :_i8, :_8, :main0, :obj, :_i7, :_7, :_i6, :_6, :_i5, :_5, :_i4, :_4, :_i3, :_3, :x, :_i2, :_2, :a_var, :_i, :_ii, :_iii, :_, :__, :___, :_i1, :_1, :e, :_oh, :_ih, :title]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;我们现在运行代码的作用域就是顶级实例变量 &lt;code class=&quot;highlighter-rouge&quot;&gt;main&lt;/code&gt; 所在的作用域。&lt;/p&gt;

&lt;h3 id=&quot;词法作用域&quot;&gt;词法作用域&lt;/h3&gt;

&lt;p&gt;词法作用域(lexical scope)也叫静态作用域(static scope)。它其实是指作用域在词法解析阶段既确定了，不会改变。在 每个 &lt;strong&gt;Scope Gate&lt;/strong&gt; 内部，&lt;strong&gt;Ruby&lt;/strong&gt; 局部变量遵循词法作用域规则，代码块的开始和结束会开启和关闭一个新的词法作用域。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;CleanRoom2&lt;/span&gt;
  
  &lt;span class=&quot;n&quot;&gt;outer1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;outer1_v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;inner1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;inter1_v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;outer2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;outer2_v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;inner2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; 
      &lt;span class=&quot;n&quot;&gt;inner2_v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;outer1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;outer2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[:inter1_v, :outer1_v, :inner1, :outer1, :outer2]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可以看到 &lt;code class=&quot;highlighter-rouge&quot;&gt;inner1&lt;/code&gt; 是在 &lt;code class=&quot;highlighter-rouge&quot;&gt;outer1&lt;/code&gt; 中定义，调用是在 &lt;code class=&quot;highlighter-rouge&quot;&gt;inner2&lt;/code&gt; 块中，可以看到在 &lt;code class=&quot;highlighter-rouge&quot;&gt;inner1&lt;/code&gt; 中的可见的变量有定义在 &lt;code class=&quot;highlighter-rouge&quot;&gt;CleanRoom&lt;/code&gt; 中的所有变量&lt;code class=&quot;highlighter-rouge&quot;&gt;[:outer1, :outer2]&lt;/code&gt;，定义在 &lt;code class=&quot;highlighter-rouge&quot;&gt;outer1&lt;/code&gt; 中的 &lt;code class=&quot;highlighter-rouge&quot;&gt;[:outer1_v, :inner1]&lt;/code&gt; 和定义在 &lt;code class=&quot;highlighter-rouge&quot;&gt;inner1&lt;/code&gt; 中的 &lt;code class=&quot;highlighter-rouge&quot;&gt;[:inner1_v]&lt;/code&gt;。尽管执行是在 &lt;code class=&quot;highlighter-rouge&quot;&gt;outer2&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;inner2&lt;/code&gt; 的内部，但是 &lt;code class=&quot;highlighter-rouge&quot;&gt;inner1&lt;/code&gt; 并不能访问它们的变量定义。&lt;/p&gt;

&lt;p&gt;通俗地说，代码块会在定义时获取周围的绑定，也可以在代码块中定义额外的绑定，但这些绑定会在块结束时消失。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;CleanRoom&lt;/span&gt;
  
  &lt;span class=&quot;n&quot;&gt;outer1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;outer1_v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;inner1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;inter1_v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;inner1 locals: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;outer1 locals: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;inner1&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;CleanRoom locals: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;outer2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;outer2_v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;inner2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; 
      &lt;span class=&quot;n&quot;&gt;inner2_v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;outer1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;outer2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CleanRoom locals: [:outer1, :outer2]
outer1 locals: [:outer1_v, :inner1, :outer1, :outer2]
inner1 locals: [:inter1_v, :outer1_v, :inner1, :outer1, :outer2]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;在代码块中，声明变量前，总是先往上查找上层环境是不是已经有该变量，如有，则直接重用，若没有则在当前块中声明该变量。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'old'&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; 
    &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'new'&lt;/span&gt; 
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;new&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;动态作用域&quot;&gt;动态作用域&lt;/h3&gt;

&lt;p&gt;与词法作用域中作用域是源代码级别上的一块完整独立的范围不同，在动态作用域中，作用域则是进入该作用域开始直至离开这一时间轴上的完整独立的范围。与此相同的特征也体现在其他好多地方。比如，在某处理进行期间，一时改变某变量的值随后将原值返回的代码编写方式就相当于创建了自己专属的动态作用域。又如，异常处理与动态作用域也很相似，函数抛出异常时的处理方式受到调用函数的 try/ catch语句的影响。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;词法作用域：讨论代码的组织结构上的抽象，讨论的是“圈地”的问题（形式上的规范）。&lt;/li&gt;
  &lt;li&gt;动态作用域：变量的可见性，完成对信息的隐藏，也就是处理“割据”问题（实际的占有）。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;现在局部变量很少会使用动态作用域，因为动态作用域中被改写的值会影响到被调用的函数，因此在引用变量时它是什么样的值，不看调用方的代码是无从得知的。如果只是为了获取调用处的值，完全可以通过参数传递来解决。动态作用域和词法作用域实现上的差别，可以参考&lt;a href=&quot;https://www.atatech.org/articles/33571#7&quot;&gt;我之前的文章&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;由于 &lt;strong&gt;Ruby&lt;/strong&gt; 局部变量不支持动态作用域，下面的例子，我们使用 &lt;strong&gt;Perl&lt;/strong&gt; 语言来演示，它同时支持词法作用域和动态作用域。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sx&quot;&gt;%%file dynamic_scope.pl
sub invoker {
    local $x = 'invoker';
    &amp;amp;func();
}

sub invoker2 {
    local $x = 'invoker2';
    &amp;amp;func();
}

$x = 'global';
sub func {
    print &quot;$x\n&quot;;
}

invoker();
invoker2();
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Writing dynamic_scope.pl
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;`perl dynamic_scope.pl`&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;invoker
invoker2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;全局变量&quot;&gt;全局变量&lt;/h2&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;global_variables&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[:$_, :$~, :$;, :$-F, :$@, :$!, :$SAFE, :$&amp;amp;, :$`, :$', :$+, :$=, :$KCODE, :$-K, :$,, :$/, :$-0, :$\, :$stdin, :$stdout, :$stderr, :$&amp;gt;, :$&amp;lt;, :$., :$FILENAME, :$-i, :$*, :$:, :$-I, :$LOAD_PATH, :$&quot;, :$LOADED_FEATURES, :$?, :$$, :$VERBOSE, :$-v, :$-w, :$-W, :$DEBUG, :$-d, :$0, :$PROGRAM_NAME, :$-p, :$-l, :$-a, :$fileutils_rb_have_lchmod, :$fileutils_rb_have_lchown, :$my_var]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Ruby&lt;/strong&gt; 中只要变量名称以 &lt;code class=&quot;highlighter-rouge&quot;&gt;$&lt;/code&gt; 开头，这个变量就是全局变量。全局变量可以再任何作用域中访问。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;scope1&lt;/span&gt;
  &lt;span class=&quot;vg&quot;&gt;$my_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;scope2&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;$my_var is &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;vg&quot;&gt;$my_var&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;scope2&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;scope1&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;scope2&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;global_variables&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$my_var is 100
$my_var is 100





[:$_, :$~, :$;, :$-F, :$@, :$!, :$SAFE, :$&amp;amp;, :$`, :$', :$+, :$=, :$KCODE, :$-K, :$,, :$/, :$-0, :$\, :$stdin, :$stdout, :$stderr, :$&amp;gt;, :$&amp;lt;, :$., :$FILENAME, :$-i, :$*, :$:, :$-I, :$LOAD_PATH, :$&quot;, :$LOADED_FEATURES, :$?, :$$, :$VERBOSE, :$-v, :$-w, :$-W, :$DEBUG, :$-d, :$0, :$PROGRAM_NAME, :$-p, :$-l, :$-a, :$fileutils_rb_have_lchmod, :$fileutils_rb_have_lchown, :$my_var]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;全局变量的问题在于系统中的任何部分都可以修改它们，我们几乎没法追踪谁把他们改成了什么。因此，基本的原则是：如非必要，尽可能少使用全局变量。&lt;/p&gt;

&lt;h2 id=&quot;实例变量&quot;&gt;实例变量&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Ruby&lt;/strong&gt; 中只要变量名称以 &lt;code class=&quot;highlighter-rouge&quot;&gt;@&lt;/code&gt; 开头，这个变量就是实例变量，它总是属于某个实例。实例变量作用域本质是&lt;strong&gt;动态作用域&lt;/strong&gt;，是进入该作用域开始直至离开这一时间轴上的完整独立的范围，也就进入这个实例开始，到离开这个实例结束。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;vi&quot;&gt;@a_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;self: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;, instance_variables: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;instance_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;，@a_var = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;instance_variable_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:@a_var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AClass&lt;/span&gt;
  &lt;span class=&quot;vi&quot;&gt;@a_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;self: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;, instance_variables: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;instance_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;，@a_var = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;instance_variable_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:@a_var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;a_method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;init_var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@a_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;init_var&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;self: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;, instance_variables: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;instance_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;，@a_var = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;instance_variable_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:@a_var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;self: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;, instance_variables: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;instance_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;，@a_var = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;instance_variable_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:@a_var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;self: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;, instance_variables: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;instance_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;，@a_var = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;instance_variable_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:@a_var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;


&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;AClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;obj2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;AClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;a_method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;obj2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;a_method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;instance_variable_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:@a_var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;AClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;instance_variable_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:@a_var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;instance_variable_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:@a_var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obj2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;instance_variable_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:@a_var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;self: main, instance_variables: [:@a_var, :@my_var]，@a_var = 1
self: AClass, instance_variables: [:@a_var]，@a_var = 2
self: AClass, instance_variables: [:@a_var]，@a_var = 2
self: main, instance_variables: [:@a_var, :@my_var]，@a_var = 1
self: #&amp;lt;AClass:0x007fefe3a04bc0&amp;gt;, instance_variables: [:@a_var]，@a_var = 3
self: #&amp;lt;AClass:0x007fefe3a04b98&amp;gt;, instance_variables: [:@a_var]，@a_var = 6
1
2
3
6
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;一般地，我们可以认为 &lt;strong&gt;Ruby&lt;/strong&gt; 所有的东西都是对象，也就是 &lt;code class=&quot;highlighter-rouge&quot;&gt;VALUE&lt;/code&gt; 的实例，包括 &lt;code class=&quot;highlighter-rouge&quot;&gt;Class&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;Module&lt;/code&gt;，接下来我们来分析一下上面的代码。&lt;/p&gt;

&lt;p&gt;代码开始，我们是在顶级上下文对象 &lt;code class=&quot;highlighter-rouge&quot;&gt;main&lt;/code&gt; 当中，&lt;code class=&quot;highlighter-rouge&quot;&gt;@a_var = 1&lt;/code&gt; 也就是给 &lt;code class=&quot;highlighter-rouge&quot;&gt;main&lt;/code&gt; 对象声明一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;@a_var&lt;/code&gt; 的一个实例变量。&lt;/p&gt;

&lt;p&gt;执行完 &lt;code class=&quot;highlighter-rouge&quot;&gt;class AClass&lt;/code&gt; 后，进入对象 &lt;code class=&quot;highlighter-rouge&quot;&gt;AClass&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;Class&lt;/code&gt; 的实例)，&lt;code class=&quot;highlighter-rouge&quot;&gt;@a_var = 2&lt;/code&gt; 也就是给 &lt;code class=&quot;highlighter-rouge&quot;&gt;AClass&lt;/code&gt; 对象声明一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;@a_var&lt;/code&gt; 的一个实例变量。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;def a_method ... end&lt;/code&gt; 为AClass新增一个实例方法 &lt;code class=&quot;highlighter-rouge&quot;&gt;a_method&lt;/code&gt;，注意，方法定义中的代码块这个时候并不会被执行。&lt;/p&gt;

&lt;p&gt;继续执行，执行完 &lt;code class=&quot;highlighter-rouge&quot;&gt;end&lt;/code&gt; 后，离开对象 &lt;code class=&quot;highlighter-rouge&quot;&gt;AClass&lt;/code&gt; 重新进入对象 &lt;code class=&quot;highlighter-rouge&quot;&gt;main&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;obj = AClass.new&lt;/code&gt; 创建 &lt;code class=&quot;highlighter-rouge&quot;&gt;AClass&lt;/code&gt; 实例 &lt;code class=&quot;highlighter-rouge&quot;&gt;obj&lt;/code&gt;，&lt;code class=&quot;highlighter-rouge&quot;&gt;obj.a_method(3)&lt;/code&gt; 执行过程简单来说，是先进入对象 &lt;code class=&quot;highlighter-rouge&quot;&gt;obj&lt;/code&gt;，接着执行 &lt;code class=&quot;highlighter-rouge&quot;&gt;a_method&lt;/code&gt; 中的代码块，最后退出对象 &lt;code class=&quot;highlighter-rouge&quot;&gt;obj&lt;/code&gt;，重新进入 &lt;code class=&quot;highlighter-rouge&quot;&gt;main&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Ruby&lt;/strong&gt; 中的所有方法都是实例方法，执行方法的时候它总有一个接收者，也就是执行该方法的当前实例，如果不指定接收者，隐含的接收者总是 &lt;code class=&quot;highlighter-rouge&quot;&gt;self&lt;/code&gt;。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;my_method1&lt;/span&gt;
  &lt;span class=&quot;vi&quot;&gt;@my_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;self: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; with instance_variables: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;instance_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;my_method2&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@my_var&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;self: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; with instance_variables: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;instance_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;my_method1&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;my_method2&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;self: main with instance_variables: [:@a_var, :@my_var]
1
self: main with instance_variables: [:@a_var, :@my_var]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;实例变量的作用域属于实际占有它的对象，一旦进入该对象，该对象的所有方法都可以对它进行访问，而不用管它定义在哪里。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ASuper&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@my_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ASubClass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ASuper&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;show_my_var&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@my_var&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;ASubClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show_my_var&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;100
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;类变量&quot;&gt;类变量&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;类变量&lt;/strong&gt; 顾名思义就是类独有的变量，但是其作用域，不同语言之间还是有一些差别。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Java&lt;/strong&gt; 中，类变量可以被类本身，类实例访问（不推荐），不能被子类本身或子类实例访问，读取修改的都是同一变量。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Python&lt;/strong&gt; 中，类变量可以被类本身，子类，类实例及子类实例访问，但是修改只可以通过类本身来修改，通过子类，类实例，或者子类实例赋值，不会修改类变量本身，等价于为子类，类实例，子类实例创建一个同名的变量。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Ruby&lt;/strong&gt; 中，类变量的作用域与 &lt;strong&gt;Python&lt;/strong&gt; 比较类似，但是对同名修改的处理方式不一样。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;A&lt;/span&gt;
  &lt;span class=&quot;vc&quot;&gt;@@a_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;
  
  &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AA&lt;/span&gt;
    &lt;span class=&quot;vc&quot;&gt;@@aa_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; variables: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;class_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; variables: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;class_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; variables: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;class_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; variables: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;class_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;AA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;A::AA variables: [:@@aa_var]
A variables: [:@@a_var]
A variables: [:@@a_var]
A::AA variables: [:@@aa_var]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;从这个例子可以看出，类变量是类间隔离的，即使它们存在嵌套定义关系。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;B&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;A&lt;/span&gt;
  
  &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;BB&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;AA&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; variables: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;class_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; variables: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;class_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;BB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;B::BB variables: [:@@aa_var]
B variables: [:@@a_var]
B variables: [:@@a_var]
B::BB variables: [:@@aa_var]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;父类中定义的类变量，子类中可以访问。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;C&lt;/span&gt;
  &lt;span class=&quot;vc&quot;&gt;@@c_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
  
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show_c&lt;/span&gt;
    &lt;span class=&quot;vc&quot;&gt;@@c_var&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;D&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;C&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;vc&quot;&gt;@@c_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show_c&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show_c&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show_c&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show_c&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1
1
11
11
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可以看到，子类中可以修改父类中的类变量，初看起来，这也不是什么大问题，我们接着再来看另外的例子。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CC&lt;/span&gt;
  &lt;span class=&quot;vc&quot;&gt;@@d_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
  
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show_d&lt;/span&gt;
    &lt;span class=&quot;vc&quot;&gt;@@d_var&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show_d&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class_variables&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class_variables&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1
[:@@d_var]
[]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CC&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;vc&quot;&gt;@@d_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show_d&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class_variables&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class_variables&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;100
[:@@d_var]
[]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;调用父类的修改方法，声明了一个同名类变量，居然把子类的同名变量给改了。不仅如此，类变量在继承树的位置也上升到了父类，说明如果继承树上有几个类含有同名类变量，&lt;strong&gt;Ruby&lt;/strong&gt; 会强制统一这些同名类变量。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Ruby&lt;/strong&gt; 中类变量陷阱还不止此，我们再来看一个例子：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CCC&lt;/span&gt;
  &lt;span class=&quot;vc&quot;&gt;@@c_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'C'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DDD&lt;/span&gt;
  &lt;span class=&quot;vc&quot;&gt;@@d_var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'D'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CCC&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DDD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;value&lt;/span&gt;
    &lt;span class=&quot;vc&quot;&gt;@@c_var&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DDD&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CCC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;value&lt;/span&gt;
    &lt;span class=&quot;vc&quot;&gt;@@d_var&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CCC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;value&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DDD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;value&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CCC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class_variables&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DDD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class_variables&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;D
C
[:@@c_var]
[:@@d_var]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;通过&lt;strong&gt;Open Class&lt;/strong&gt;，我们很轻松地打破了类隔离的规则。&lt;/p&gt;

&lt;p&gt;我们再来看看类变量与实例之间的关系：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;C&lt;/span&gt;
  &lt;span class=&quot;vc&quot;&gt;@@value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'c'&lt;/span&gt;
  
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;show&lt;/span&gt;
    &lt;span class=&quot;vc&quot;&gt;@@value&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;vc&quot;&gt;@@value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'new'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;c
new
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CC&lt;/span&gt; 
  &lt;span class=&quot;vc&quot;&gt;@@value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'c'&lt;/span&gt;
  
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;value&lt;/span&gt;
    &lt;span class=&quot;vc&quot;&gt;@@value&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CC&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;show&lt;/span&gt;
    &lt;span class=&quot;vc&quot;&gt;@@value&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;vc&quot;&gt;@@value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'new'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;show&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;value&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;c
new
new
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;类实例和子类实例都可以访问和修改类变量，如果使用不小心，特别容易造成错误的修改，错误很难追踪。&lt;/p&gt;

&lt;p&gt;正是由于 &lt;strong&gt;Ruby&lt;/strong&gt; 类变量的这些特性，特别容易导致错误，尤其是在元编程的时候，所以一般都不推荐在程序中使用类变量。&lt;/p&gt;

&lt;p&gt;其实类变量主要的功能还是类间隔离，父子类之间共享类变量其实是没有必要的，上类中 &lt;code class=&quot;highlighter-rouge&quot;&gt;D&lt;/code&gt; 继承 &lt;code class=&quot;highlighter-rouge&quot;&gt;C&lt;/code&gt;，只是表明 &lt;code class=&quot;highlighter-rouge&quot;&gt;D&lt;/code&gt; 的实例也是 &lt;code class=&quot;highlighter-rouge&quot;&gt;C&lt;/code&gt; 的实例，但是 &lt;code class=&quot;highlighter-rouge&quot;&gt;D&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;C&lt;/code&gt; 之间并没有从属关系，他们都是 &lt;code class=&quot;highlighter-rouge&quot;&gt;Class&lt;/code&gt; 的实例。&lt;/p&gt;

&lt;p&gt;其实 &lt;strong&gt;Ruby&lt;/strong&gt; 也可以轻松实现类似 &lt;strong&gt;Java&lt;/strong&gt; 类变量的方案，那就是借助实例变量来模拟。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MyClass&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;val&lt;/span&gt;
      &lt;span class=&quot;vi&quot;&gt;@val&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;vi&quot;&gt;@val&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;MyClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;val&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;MyClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;MyClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;val&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;100
100
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;只所以可以这么做，是因为 &lt;code class=&quot;highlighter-rouge&quot;&gt;MyClass&lt;/code&gt; 本身也是一个对象，它是 &lt;code class=&quot;highlighter-rouge&quot;&gt;Class&lt;/code&gt; 的实例，因为实例变量只可以被对象自身访问。即便是 &lt;code class=&quot;highlighter-rouge&quot;&gt;MyClass&lt;/code&gt; 的子类，也不能访问 &lt;code class=&quot;highlighter-rouge&quot;&gt;@val&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;基于以上的事实，用 &lt;strong&gt;Ruby&lt;/strong&gt; 编程的时候，如果不是有特殊的需求，尽量不要使用类变量，尤其是在 &lt;strong&gt;Open Class&lt;/strong&gt; 的场景。&lt;/p&gt;

&lt;p&gt;更多 Ruby 资料整理，移步&lt;a href=&quot;https://github.com/jameszhan/notes-ruby&quot;&gt;Ruby 编程手札&lt;/a&gt;&lt;/p&gt;
</description>
        <pubDate>Sat, 03 Feb 2018 22:00:00 +0000</pubDate>
        <link>http://localhost:4000/2018/02/03/ruby-variable-scope.html</link>
        <guid isPermaLink="true">http://localhost:4000/2018/02/03/ruby-variable-scope.html</guid>
        
        <category>ruby</category>
        
        <category>metaprogramming</category>
        
        <category>dsl</category>
        
        <category>pdt</category>
        
        
        <category>ruby</category>
        
      </item>
    
      <item>
        <title>简单谈下 Ruby 中的代码块</title>
        <description>&lt;h2 id=&quot;简介&quot;&gt;简介&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Block&lt;/strong&gt; 是 &lt;strong&gt;Ruby&lt;/strong&gt; 的一个独特特性，它本质上就是一组代码，通过它，可以很容易实现回调，或传递一组代码（远比C的函数指针灵活），以及实现迭代器。这是一个不可思议的功能强大的特性。&lt;/p&gt;

&lt;p&gt;语法表现上，&lt;strong&gt;Block&lt;/strong&gt; 是花括号或者&lt;code class=&quot;highlighter-rouge&quot;&gt;do&lt;/code&gt;和&lt;code class=&quot;highlighter-rouge&quot;&gt;end&lt;/code&gt;之间的一组代码，按照社区约定，我们可以通过以下两种方式来书写 &lt;strong&gt;Block&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;多行，使用&lt;code class=&quot;highlighter-rouge&quot;&gt;do&lt;/code&gt;和&lt;code class=&quot;highlighter-rouge&quot;&gt;end&lt;/code&gt;作为开始和结束。&lt;/li&gt;
  &lt;li&gt;单行，使用花括号&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1
2
3
1
2
3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;概念&quot;&gt;概念&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Block&lt;/strong&gt; 相关的一些术语&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;闭包，&lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt;，&lt;code class=&quot;highlighter-rouge&quot;&gt;lambda&lt;/code&gt;, 函数，函数指针，匿名函数&lt;/li&gt;
  &lt;li&gt;回调，&lt;code class=&quot;highlighter-rouge&quot;&gt;callable&lt;/code&gt;，&lt;code class=&quot;highlighter-rouge&quot;&gt;functor&lt;/code&gt;，&lt;code class=&quot;highlighter-rouge&quot;&gt;delegate&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;我们介绍下其中的几个概念。&lt;/p&gt;

&lt;h4 id=&quot;闭包&quot;&gt;闭包&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;一个包含了自由变量的开放表达式，它和该自由变量的约束环境组合在一起后，实现了一种封闭的状态。 ──  Functional programming using standard ML, Prentice- Hall, 1987. 15&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;在计算机科学中，闭包（Closure）是词法闭包（Lexical Closure）的简称，是引用了自由变量的表达式（通常是函数）。这些被引用的自由变量将和这个函数一同存在，即使已经离开了创造它的环境也不例外。 词法作用域(lexical scope)也叫静态作用域(static scope)。所谓的词法作用域其实是指作用域在词法解析阶段既确定了，不会改变，简单理解，就是代码块定义在哪里，就引用哪里的上下文环境。&lt;/p&gt;

&lt;p&gt;闭包的数据结构可以定义为，包含一个函数定义 f 和它定义时所在的环境 (struct Closure (f env))&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;全局函数是一个有名字但不会捕获任何值的闭包。&lt;/li&gt;
  &lt;li&gt;嵌套函数是一个有名字并可以捕获其封闭函数域内值得闭包。&lt;/li&gt;
  &lt;li&gt;Lambda(闭包表达式)是一个利用轻量级语法所写的可以捕获其上下文中变量值的匿名闭包。&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;函数指针&quot;&gt;函数指针&lt;/h4&gt;

&lt;p&gt;函数指针在&lt;code class=&quot;highlighter-rouge&quot;&gt;C&lt;/code&gt;语言中用的比较多，本质上，它就是一个内存地址，只不过指向的是一块可执行代码的首地址。和闭包相比，它并没有附带定义该函数的上下文信息，也不负责指针类型检查。&lt;/p&gt;

&lt;h4 id=&quot;functor&quot;&gt;functor&lt;/h4&gt;

&lt;p&gt;在&lt;code class=&quot;highlighter-rouge&quot;&gt;C++&lt;/code&gt;中，&lt;strong&gt;functor&lt;/strong&gt; 是行为类似函数的对象，可以拥有成员函数和成员变量，即 &lt;strong&gt;functor&lt;/strong&gt; 拥有状态，其本质和闭包很接近，只是用起来比较繁琐。&lt;/p&gt;

&lt;h4 id=&quot;delegate&quot;&gt;delegate&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;C#&lt;/code&gt;中的 &lt;code class=&quot;highlighter-rouge&quot;&gt;delegate&lt;/code&gt; 类似于 &lt;code class=&quot;highlighter-rouge&quot;&gt;C&lt;/code&gt; 或 &lt;code class=&quot;highlighter-rouge&quot;&gt;C++&lt;/code&gt; 中的函数指针。使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;delegate&lt;/code&gt; 使程序员可以将方法引用封装在委托对象内。然后可以将该 &lt;code class=&quot;highlighter-rouge&quot;&gt;delegate&lt;/code&gt; 对象传递给可调用所引用方法的代码，而不必在编译时知道将调用哪个方法。与C或C++中的函数指针不同，&lt;code class=&quot;highlighter-rouge&quot;&gt;delegate&lt;/code&gt; 是面向对象、类型安全的，并且是安全的。&lt;/p&gt;

&lt;h2 id=&quot;可调用对象callable-object&quot;&gt;可调用对象(&lt;code class=&quot;highlighter-rouge&quot;&gt;callable object&lt;/code&gt;)&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Ruby&lt;/strong&gt; 中，可调用对象是可执行的代码片段，它们都有自己的作用域，可调用对象有以下几种方式：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;block&lt;/strong&gt;，在定义它们的作用域中执行，它是闭包的一种。&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;proc&lt;/strong&gt;，&lt;code class=&quot;highlighter-rouge&quot;&gt;Proc&lt;/code&gt; 类的对象，和块一样，它们也在定义自身的作用域中执行，它也是闭包的一种。&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;lambda&lt;/strong&gt;，也是 &lt;code class=&quot;highlighter-rouge&quot;&gt;Proc&lt;/code&gt; 类的对象，和块一样，它们也在定义自身的作用域中执行，它和 &lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; 用法有细微的区别，也是闭包的一种。&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;method&lt;/strong&gt;，绑定于对象，在所绑定对象的作用域中执行。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;block&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;block&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;block&lt;/code&gt; 闭包测试要麻烦一些，因为很多时候，很多时候都是在定义它的作用域中直接执行它，达不到逃逸的效果，为了验证 &lt;code class=&quot;highlighter-rouge&quot;&gt;block&lt;/code&gt; 的闭包特性，我们需要先把 &lt;code class=&quot;highlighter-rouge&quot;&gt;block&lt;/code&gt; 捕获起来，然后再调用。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;capture_block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;clean_room&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;level_0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;level0&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;level_1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'level_1'&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;proc&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;level_2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'level_2'&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;capture_block&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;level_3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'level_3'&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;block locals: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; 
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;callable&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clean_room&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;block0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;callable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;block0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;block locals: [:level_3, :level_2, :level_1, :level_0]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;上面的例子中其实有一个不严谨的地方，捕获块的时候，其实有一个隐式的转换。&lt;/p&gt;

&lt;p&gt;上例中，&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt; 对应的就是代码块：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;level_3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'level_3'&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;block locals: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;当去掉 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;&lt;/code&gt; 直接访问 &lt;code class=&quot;highlighter-rouge&quot;&gt;block&lt;/code&gt; 的时候，&lt;strong&gt;Ruby&lt;/strong&gt; 会自动把 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt; 对应的代码块封装成一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;Proc&lt;/code&gt; 对象。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;block0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Proc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt; 应该算是 &lt;strong&gt;Ruby&lt;/strong&gt; 中的唯一一个不是对象的实体，它代表的是一组可以执行的代码，无法直接访问它，下面的代码会抛 &lt;code class=&quot;highlighter-rouge&quot;&gt;SyntaxError&lt;/code&gt;。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;proc0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Proc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;hello world&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;proc0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;通过 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;&lt;/code&gt; 运算符，我们可以在 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;Proc&lt;/code&gt; 对象之间进行转换。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;proc0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Proc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Hello World&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;proc0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;Hello World&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;proc&quot;&gt;proc&lt;/h3&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;clean_room&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;level_0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;level0&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;level_1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'level_1'&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;proc&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;level_2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'level_2'&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;proc&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;level_3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'level_3'&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;proc locals: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; 
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;callable&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clean_room&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;proc0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;callable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;proc0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;proc locals: [:level_3, :level_2, :level_1, :level_0]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;lambda&quot;&gt;lambda&lt;/h3&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;clean_room&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;level_0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;level0&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;level_1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'level_1'&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;proc&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;level_2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'level_2'&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;level_3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'level_3'&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;lambda locals: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;local_variables&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; 
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;callable&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clean_room&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;lambda0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;callable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lambda0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;lambda locals: [:level_3, :level_2, :level_1, :level_0]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;ruby 1.9&lt;/strong&gt; 之后，&lt;code class=&quot;highlighter-rouge&quot;&gt;lambda&lt;/code&gt;还可以使用更简便的 &lt;code class=&quot;highlighter-rouge&quot;&gt;-&amp;gt;&lt;/code&gt; 记法。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Hello World!&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Hello World!
3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;block&lt;/code&gt;，&lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;lambda&lt;/code&gt; 的区别，后面再重点介绍。&lt;/p&gt;

&lt;p&gt;再来看一个例子：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;make_counter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;make_counter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;make_counter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;c1 = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;, c2 = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;c1 = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;, c2 = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;c1 = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;, c2 = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;c1 = 7, c2 = 4
c1 = 5, c2 = 2
c1 = 3, c2 = 0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;make_counter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;proc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;make_counter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;make_counter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;c1 = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;, c2 = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;c1 = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;, c2 = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;c1 = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;, c2 = &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;c1 = 8, c2 = 5
c1 = 7, c2 = 4
c1 = 6, c2 = 3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;yield&quot;&gt;yield&lt;/h2&gt;

&lt;p&gt;有别于其他语言，&lt;strong&gt;Ruby&lt;/strong&gt; 中的 &lt;code class=&quot;highlighter-rouge&quot;&gt;yield&lt;/code&gt; 是一种调用闭包的快捷方式。&lt;strong&gt;Ruby&lt;/strong&gt; 有一种特殊的语法把匿名函数传递给一个方法，这种语法就是&lt;code class=&quot;highlighter-rouge&quot;&gt;block&lt;/code&gt;。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;twice&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;twice&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;hi!&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;hi!
hi!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Ruby&lt;/strong&gt; 中对于所有方法，无论它的参数列表长什么样，它都可以在后面跟上一个可选的 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt;。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kwargs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt; 严格来说不是一个参数，更像是一个声明，它指示一组执行代码的地址，如果直接访问 &lt;code class=&quot;highlighter-rouge&quot;&gt;block&lt;/code&gt; 则会把这组代码封装在 &lt;code class=&quot;highlighter-rouge&quot;&gt;Proc&lt;/code&gt; 对象当中，并把引用赋值给 &lt;code class=&quot;highlighter-rouge&quot;&gt;block&lt;/code&gt;。这个块也可以使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;yield&lt;/code&gt; 来调用，这样可以不用关心代码块的名称。&lt;/p&gt;

&lt;p&gt;如果显式地指定 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt; 参数，则 &lt;code class=&quot;highlighter-rouge&quot;&gt;yield&lt;/code&gt; 调用的就是 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt; 传入的代码块。&lt;/p&gt;

&lt;p&gt;直观理解，&lt;code class=&quot;highlighter-rouge&quot;&gt;yield&lt;/code&gt; 可以理解是一个占位，指示 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt; 被调用的位置，并把 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt; 所需参数传递过去。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;3
3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;一个方法只能有一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt; 参数，&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt; 只可以是最后一个方法参数。&lt;/p&gt;

&lt;p&gt;以下的方法定义，都会抛 &lt;code class=&quot;highlighter-rouge&quot;&gt;SyntaxError&lt;/code&gt;。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;multi_block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;      &lt;span class=&quot;c1&quot;&gt;# 超过一个 block 参数&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;block_first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;           &lt;span class=&quot;c1&quot;&gt;# 出错，block 不是最后一个参数&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如果需要传入多个代码块到同一个方法，则其它对象需要使用 &lt;strong&gt;可调用对象&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ifthen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;predict&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;predict&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Ignore&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ifthen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;lambda is executed&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ifthen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;proc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;proc is executed&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;my_method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ifthen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:my_method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;method is executed&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;lambda is executed
proc is executed
method is executed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;block_given&quot;&gt;block_given?&lt;/h2&gt;

&lt;p&gt;任何方法在调用的时候后面都可以挂载一个&lt;strong&gt;代码块&lt;/strong&gt;，尽管有时完全用不上这个&lt;strong&gt;代码块&lt;/strong&gt;。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;This code never called without yield!&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如果你定义的方法想使用&lt;strong&gt;代码块&lt;/strong&gt;做点事情，那么你需要使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;yield&lt;/code&gt; 关键字或者 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;但是一旦方法中使用了 &lt;code class=&quot;highlighter-rouge&quot;&gt;yield&lt;/code&gt; 关键字或者 &lt;code class=&quot;highlighter-rouge&quot;&gt;block.call&lt;/code&gt;，则方法在调用的时候必须跟上一个代码块，哪怕这个代码块什么都不做。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;f1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;f1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;f1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;rescue&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;LocalJumpError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;LocalJumpError: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;LocalJumpError: no block given (yield)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;f2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;f2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;f2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;rescue&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;NoMethodError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;NoMethodError: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;NoMethodError: undefined method `call' for nil:NilClass
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如下两种方法定义是等效的：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;f2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;f2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如果方法实现中，使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;yield&lt;/code&gt; 调用代码块的话，方法声明可以省掉 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt;。如果单看方法声明，使用方完全意识不到使用该方法还必须挂一个代码块，否则就会抛出 &lt;code class=&quot;highlighter-rouge&quot;&gt;LocalJumpError&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;基于以上原因， &lt;strong&gt;Ruby&lt;/strong&gt; 提供了 &lt;code class=&quot;highlighter-rouge&quot;&gt;block_given?&lt;/code&gt; 方法来判断方法后面是否挂了代码块，方便开发者在定义方法时能够考虑调用方忘记带上代码块的情形。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;f1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;block_given?&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;f2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;block_given?&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;f1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;f2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;yield-vs-blockcall&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;yield&lt;/code&gt; vs &lt;code class=&quot;highlighter-rouge&quot;&gt;block.call&lt;/code&gt;&lt;/h2&gt;

&lt;p&gt;理论上，&lt;code class=&quot;highlighter-rouge&quot;&gt;yield&lt;/code&gt; 比 &lt;code class=&quot;highlighter-rouge&quot;&gt;block.call&lt;/code&gt; 执行起来要高效一些，因为在调用之前需要先将 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;block&lt;/code&gt; 转换成 &lt;code class=&quot;highlighter-rouge&quot;&gt;Proc&lt;/code&gt; 对象。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;f2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;block_given?&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;f2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Hello World&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Hello World
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;上面的代码，如果把过程展开，等价于：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;f2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;block_given?&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;blk&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Proc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt; 
    &lt;span class=&quot;n&quot;&gt;blk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;f2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Hello World&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Hello World
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;另外，使用匿名代码块的写法也要简洁一些，不过显式的代码块要灵活一些，你可以显式把 &lt;code class=&quot;highlighter-rouge&quot;&gt;block&lt;/code&gt; 传递给其他被调用方法。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ls_files&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;Dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;glob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;*.ipynb&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ipynb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ipynb&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ls_files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;03.02-conditional-statements.ipynb
03.04-iterators.ipynb
03.10-ruby-meta-programming.ipynb
03.11-ruby-style-guide.ipynb
03.03-loop-statements.ipynb
03.07-scope.ipynb
03.01-assignment-statements.ipynb
03.05-functions.ipynb
03.06-blocks.ipynb
03.09-exceptions.ipynb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ls_files2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;Dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;glob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;*.ipynb&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ls_files2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;03.02-conditional-statements.ipynb
03.04-iterators.ipynb
03.10-ruby-meta-programming.ipynb
03.11-ruby-style-guide.ipynb
03.03-loop-statements.ipynb
03.07-scope.ipynb
03.01-assignment-statements.ipynb
03.05-functions.ipynb
03.06-blocks.ipynb
03.09-exceptions.ipynb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;symbolto_proc&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Symbol#to_proc&lt;/code&gt;&lt;/h2&gt;

&lt;p&gt;这种有点诡异的法术在Ruby程序员中很流行，请看下面的代码：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;names&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'bob'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'bill'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'heather'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;names&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;capitalize&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[&quot;Bob&quot;, &quot;Bill&quot;, &quot;Heather&quot;]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;更简洁的写法&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;names&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'bob'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'bill'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'heather'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;names&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:capitalize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[&quot;Bob&quot;, &quot;Bill&quot;, &quot;Heather&quot;]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;当&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;&lt;/code&gt;操作符作用于一个对象时，它会调用该对象的&lt;code class=&quot;highlighter-rouge&quot;&gt;to_proc&lt;/code&gt;方法，先将其转化为一个&lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt;对象，再把他转换为对应的代码块。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;:capitalize&lt;/code&gt; 是 &lt;code class=&quot;highlighter-rouge&quot;&gt;Symbol&lt;/code&gt; 类的实例, &lt;code class=&quot;highlighter-rouge&quot;&gt;Symbol&lt;/code&gt; 中的 &lt;code class=&quot;highlighter-rouge&quot;&gt;to_proc&lt;/code&gt; 方法的实现类似于：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Symbol&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;to_proc&lt;/span&gt;
        &lt;span class=&quot;no&quot;&gt;Proc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;上面的代码等价于：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;names&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'bob'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'bill'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'heather'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:capitalize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_proc&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;names&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[&quot;Bob&quot;, &quot;Bill&quot;, &quot;Heather&quot;]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;proc-vs-lamba&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; vs. &lt;code class=&quot;highlighter-rouge&quot;&gt;lamba&lt;/code&gt;&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;lambda&lt;/code&gt; 之间的差异可能是 &lt;strong&gt;Ruby&lt;/strong&gt; 中最令人费解的特性。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;callable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;callable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;proc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Proc called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Lambda called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Proc called
Lambda called
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;在 &lt;strong&gt;Ruby&lt;/strong&gt; 中，最后一行的 &lt;code class=&quot;highlighter-rouge&quot;&gt;return&lt;/code&gt; 关键字是经常可以省略的，但是在 &lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;lambda&lt;/code&gt; 当中，加上 &lt;code class=&quot;highlighter-rouge&quot;&gt;return&lt;/code&gt; 关键字后，他们的行为是不一致的。&lt;/p&gt;

&lt;p&gt;在 &lt;code class=&quot;highlighter-rouge&quot;&gt;lambda&lt;/code&gt; 中，&lt;code class=&quot;highlighter-rouge&quot;&gt;return&lt;/code&gt; 仅仅表示从这个 &lt;code class=&quot;highlighter-rouge&quot;&gt;lambda&lt;/code&gt; 中返回，在 &lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; 当中，它不是从 &lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; 中返回，而是从定义 &lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; 的上下文中返回。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;callable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before callable called&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;callable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after callable called&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;:run
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Lambda called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;before callable called
Lambda called
after callable called
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; 的行为比较诡异，更好的设计应该是从 &lt;code class=&quot;highlighter-rouge&quot;&gt;run&lt;/code&gt; 方法返回，&lt;code class=&quot;highlighter-rouge&quot;&gt;lambda&lt;/code&gt; 更像是一个方法调用，而 &lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; 则相当于把代码块插入到调用的位置去执行，上面的执行代码等价于：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;binding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before callable called&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;binding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after callable called&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;proc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Proc called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt; 
  &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'return &quot;Proc called&quot;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;binding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;k&quot;&gt;rescue&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;LocalJumpError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;proc executed error &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;before callable called
proc executed error unexpected return.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;当执行到 &lt;code class=&quot;highlighter-rouge&quot;&gt;return &quot;Proc called&quot;&lt;/code&gt; 的时候，原本应该返回到 &lt;code class=&quot;highlighter-rouge&quot;&gt;run&lt;/code&gt; 的返回地址，但是因为 &lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; 记录的确是定义它的 &lt;code class=&quot;highlighter-rouge&quot;&gt;main&lt;/code&gt; 返回地址，因此报错，如果不考虑绑定，更直观的展开如下。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before callable called&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Proc called&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after callable called&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;callable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before callable called&quot;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;callable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after callable called&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;proc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;proc called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  
&lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt; 
  &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;k&quot;&gt;rescue&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;LocalJumpError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;proc executed error &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;before callable called
proc executed error unexpected return.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt; 
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Proc called&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;rescue&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;LocalJumpError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;proc executed error &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;proc executed error unexpected return.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;不过只要我们弄明白了这个坑点，倒是可以用来做一些有意思的事情。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;count_down_to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;sentry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;proc&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;count down finished by sentry!&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  
  &lt;span class=&quot;n&quot;&gt;l&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sentry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  
  &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;downto&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;', '&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;count down finish!&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count_down_to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count_down_to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;10, 9, 8, 7, 6, 5, 4, 3, count down finish!
10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, count down finished by sentry!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;lambda&lt;/code&gt; 还有点重要的区别来自他们检查参数的方式，&lt;code class=&quot;highlighter-rouge&quot;&gt;lambda&lt;/code&gt; 总是检查传入的参数数量，如果和定义的不匹配，会抛出一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;ArgumentError&lt;/code&gt;。而 &lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; 则会把传递进来的参数调整为自己期望的参数形式，如果参数比期望的要多，&lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; 会忽略多余的参数，如果参数数量不足，那么对未指定的参数，proc会赋一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;nil&lt;/code&gt; 值。&lt;/p&gt;

&lt;p&gt;我们再来看 &lt;code class=&quot;highlighter-rouge&quot;&gt;block&lt;/code&gt;，它的行为更像 &lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt;，所以一般我们最好不要在 &lt;code class=&quot;highlighter-rouge&quot;&gt;block&lt;/code&gt; 块中使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;return&lt;/code&gt;，除非你明确知道自己在干什么。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before callable called&quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after callable called&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Block called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arg1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;arg2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Do not check the arguments&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt; 
  &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Block called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;rescue&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;LocalJumpError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;block executed error &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;before callable called
Block called
after callable called
before callable called
Do not check the arguments
after callable called
before callable called
block executed error unexpected return.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;整体而言，&lt;code class=&quot;highlighter-rouge&quot;&gt;lambda&lt;/code&gt; 更直观，也更像一个方法，它不仅对参数数量要求严格，而且在调用 &lt;code class=&quot;highlighter-rouge&quot;&gt;return&lt;/code&gt; 时，只在 &lt;code class=&quot;highlighter-rouge&quot;&gt;lambda&lt;/code&gt; 的代码块返回。基于这些原因，如没有使用到某些 &lt;code class=&quot;highlighter-rouge&quot;&gt;proc&lt;/code&gt; 的特殊功能，应该总是优先选择使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;lambda&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;更多 &lt;strong&gt;Ruby&lt;/strong&gt; 资料整理，移步&lt;a href=&quot;https://github.com/jameszhan/notes-ruby&quot;&gt;Ruby 编程手札&lt;/a&gt;&lt;/p&gt;
</description>
        <pubDate>Fri, 02 Feb 2018 22:00:00 +0000</pubDate>
        <link>http://localhost:4000/2018/02/02/ruby-code-block.html</link>
        <guid isPermaLink="true">http://localhost:4000/2018/02/02/ruby-code-block.html</guid>
        
        <category>ruby</category>
        
        <category>metaprogramming</category>
        
        <category>dsl</category>
        
        <category>pdt</category>
        
        
        <category>ruby</category>
        
      </item>
    
      <item>
        <title>梯度下降从放弃到入门</title>
        <description>&lt;h3 id=&quot;梯度&quot;&gt;梯度&lt;/h3&gt;

&lt;p&gt;在向量微积分中，标量场的梯度是一个向量场。标量场中某一点上的梯度指向标量场增长最快的方向，梯度的长度是这个最大的变化率。&lt;/p&gt;

&lt;p&gt;在三维直角坐标系中表示为：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\nabla \varphi = \left( \frac{\partial \varphi}{\partial x}, \frac{\partial \varphi}{\partial y}, \frac{\partial \varphi}{\partial z}\right) 
= \frac{\partial \varphi}{\partial x}\vec{i} + \frac{\partial \varphi}{\partial y}\vec{j} + \frac{\partial \varphi}{\partial z}\vec{k}&lt;/script&gt;

&lt;h3 id=&quot;梯度下降&quot;&gt;梯度下降&lt;/h3&gt;

&lt;p&gt;梯度下降是一个用来求函数最小值的算法，在机器学习所有优化算法当中，梯度下降应该算是最受关注并且用的最多的一个算法。&lt;/p&gt;

&lt;p&gt;梯度下降背后的思想是：开始时我们随机选取一个参数的组合$(\theta_0,\theta_1,\cdots,\theta_n)$，计算代价函数$J(\theta)$，然后我们寻找下一个能让代价函数值下降最多的参数组合。我们持续这么做，直到找到一个局部最小值，因为我们并没有尝试完所有的参数组合，所以不能确定我们得到局部最小值是否便是全局最小值，不同的初始参数组合，可能会找到不同的局部最小值。如果我们知道代价函数是一个凸函数，那么我们就可以保证我们找到的局部最小点就是全局最小点。&lt;/p&gt;

&lt;p&gt;通过梯度的定义，我们知道，梯度的方向是增长（上升）最快的方向，那么梯度的反方向便是让代价函数下降程度最大的方向。&lt;/p&gt;

&lt;p&gt;定义$\alpha$为学习率（learning rate），它决定了我们沿着能让代价函数下降程度最大的方向更新的步长。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\theta_j = \theta_j - \alpha \frac{\partial J(\theta)}{\partial \theta_j}&lt;/script&gt;

&lt;p&gt;每走一步，我们都要重新计算函数在当前点的梯度，然后选择梯度的反方向作为走下去的方向。随着每一步迭代，梯度不断地减小，到最后减小为零。&lt;/p&gt;

&lt;h3 id=&quot;线性回归&quot;&gt;线性回归&lt;/h3&gt;

&lt;p&gt;假定我们有一批数据点，需要根据这些点找出最适合的线性方程$y = ax + b$。&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.199&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.389&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.580&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.783&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.980&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.177&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.380&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.575&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.771&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/gd_points.png&quot; alt=&quot;GDPoints&quot; /&gt;&lt;/p&gt;

&lt;p&gt;也就是要找出最合适的参数$(a, b)$，使得直线到所有点的距离尽可能小。他可以转化为求解代价函数1&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;J(a, b) = \sum_{i=1}^m\left(ax^{(i)} + b - y^{(i)}\right)^2&lt;/script&gt;

&lt;p&gt;的最小值。&lt;/p&gt;

&lt;p&gt;我们也可以令$J(a, b)$为误差平方和（SSE）的平均数，为了后续求导计算方便，我们还可以再把他除以2，即代价函数2&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;J(a, b) = \frac{1}{2m}\sum_{i=1}^m\left(ax^{(i)} + b - y^{(i)}\right)^2&lt;/script&gt;

&lt;p&gt;如果$(a, b)$在代价函数2上取得最小值，也必在代价函数1上取的最小值。&lt;/p&gt;

&lt;p&gt;其中&lt;script type=&quot;math/tex&quot;&gt;x^{(i)}, y^{(i)}&lt;/script&gt;为已知数。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\frac{\partial}{\partial a}J(a,b)
=  \frac{\partial}{\partial a}\left(\frac{1}{2m}\sum_{i=1}^m\left(ax^{(i)} + b - y^{(i)}\right)^2\right)
= \frac{1}{m}\sum_{i=1}^m\left(ax^{(i)} + b - y^{(i)}\right)x^{(i)}&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\frac{\partial}{\partial b}J(a,b)
=  \frac{\partial}{\partial b}\left(\frac{1}{2m}\sum_{i=1}^m\left(ax^{(i)} + b - y^{(i)}\right)^2\right)
= \frac{1}{m}\sum_{i=1}^m\left(ax^{(i)} + b - y^{(i)}\right)&lt;/script&gt;

&lt;p&gt;利用梯度下降法，我们很容易实现对应的迭代解法。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;a := a - \alpha \frac{\partial}{\partial a}J(a,b)&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;b := b - \alpha \frac{\partial}{\partial b}J(a,b)&lt;/script&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;gd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1e-8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sse2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;grad_a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;grad_b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;diff&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;grad_a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;diff&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;grad_b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;diff&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;grad_a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;grad_a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;grad_b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;grad_b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;grad_a&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;grad_b&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sse2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;sse2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;测试代码如下:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.05&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1e-6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'y = {0} * x + {1}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# y = 0.193958973089 * x + 0.0161212366801&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'o'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Original data'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;markersize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'r'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Fitted line'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/assets/images/gd_points_fit.png&quot; alt=&quot;GDPointsFit&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;多变量线性回归&quot;&gt;多变量线性回归&lt;/h3&gt;

&lt;p&gt;上例，我们演示了一元线性回归梯度下降的迭代解法，更一般地，我们考虑n个变量的情况，我们有m条记录。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[
\left[
    \begin{array}{ccccc|c}
x^{(1)}_{0} &amp; x^{(1)}_{1} &amp; x^{(1)}_{2} &amp; \cdots &amp; x^{(1)}_{n} &amp; y^{(1)} \\
x^{(2)}_{0} &amp; x^{(2)}_{1} &amp; x^{(2)}_{2} &amp; \cdots &amp; x^{(2)}_{n} &amp; y^{(2)} \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\
x^{(m)}_{0} &amp; x^{(m)}_{1} &amp; x^{(m)}_{2} &amp; \cdots &amp; x^{(m)}_{n} &amp; y^{(m)} \\
    \end{array}
\right] %]]&gt;&lt;/script&gt;

&lt;p&gt;&lt;span&gt;为了不失一般性和简化公式，我们令 $\left.x_0^{(i)} = 1\right|_{i \in (1,2,\cdots,m)}$ &lt;/span&gt;&lt;/p&gt;

&lt;p&gt;我们需要找到一个假设$h$，使得应用到上述数据，其代价函数最小。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;h_{\theta}(x) = \theta_0x_0 + \theta_1x_1 + \theta_2x_2 + \cdots + \theta_nx_n&lt;/script&gt;

&lt;p&gt;或者&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[
h_{\theta}(x) = \sum_{j=0}^n\theta_jx_j
= 
\begin{bmatrix}
\theta_0 &amp; \theta_1 &amp; \cdots &amp; \theta_n
\end{bmatrix}
\cdot
\begin{bmatrix}
x_0 \\
x_1 \\
\vdots \\
x_n \\
\end{bmatrix}
= \theta^TX %]]&gt;&lt;/script&gt;

&lt;p&gt;其中，$x_0 = 1$, $\theta_0$为偏置。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;J(\theta) = \frac{1}{2m}\sum_{i=1}^m\left(h_{\theta}\left(x^{(i)}\right) - y^{(i)}\right)^2&lt;/script&gt;

&lt;p&gt;则$J(\theta)$梯度为&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\nabla J(\theta) = 
\begin{bmatrix}
\frac{\partial J(\theta)}{\partial\theta_0} \\
\frac{\partial J(\theta)}{\partial\theta_1} \\
\frac{\partial J(\theta)}{\partial\theta_2} \\
\vdots                              \\ 
\frac{\partial J(\theta)}{\partial\theta_n} \\
\end{bmatrix}&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\frac{\partial J(\theta)}{\partial\theta_j} 
= \frac{\partial}{\partial\theta_j}\left(\frac{1}{2m}\sum_{i=1}^m\left(h_{\theta}\left(x^{(i)}\right) - y^{(i)}\right)^2\right) 
= \frac{1}{m}\sum_{i=1}^m\left(h_{\theta}\left(x^{(i)}\right) - y^{(i)}\right)x_j^{(i)}&lt;/script&gt;

&lt;p&gt;利用梯度下降法，我们很容易实现对应的迭代解法。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\theta_j := \theta_j - \alpha \frac{\partial}{\partial\theta_j}J(\theta)&lt;/script&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;gd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1e-6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sse2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;gradient&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;hypothesis&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;jj&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hypothesis&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;gradient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;gradient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gradient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;
            
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gradient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;jj&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sse2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;sse2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;之所以不在同一个循环里面同时计算梯度和更新$\theta$，是因为正确的做法需要保证$\theta$同时更新。&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 取x_0 = 1&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;2.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;3.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;4.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;5.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;6.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;7.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;8.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;9.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.199&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.389&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.580&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.783&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.980&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.177&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.380&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.575&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.771&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.05&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1e-6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'y = {0} * x + {1}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# y = 0.193953964855 * x + 0.01615274985&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;更优雅的实现&quot;&gt;更优雅的实现&lt;/h3&gt;

&lt;p&gt;之前一直有个疑问，不清楚为什么用显卡可以提高优化算法的执行效率，直到我接触到了如下代码：&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gradient&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gradient&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;利用矩阵运算，代码可以变的相当简洁，而且可以利用显卡多核的优势。&lt;/p&gt;

&lt;p&gt;推导过程如下：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;LOSS 
= 
\begin{bmatrix}
loss^{(1)} \\
loss^{(2)} \\
\vdots \\
loss^{(m)} \\
\end{bmatrix}
=
\begin{bmatrix}
h_{\theta}(x^{(1)}) - y^{(1)} \\
h_{\theta}(x^{(2)}) - y^{(2)} \\
\vdots \\
h_{\theta}(x^{(m)}) - y^{(m)} \\
\end{bmatrix}
=
\begin{bmatrix}
\sum_{j=0}^nx^{(1)}_{j}\theta_j \\
\sum_{j=0}^nx^{(2)}_{j}\theta_j \\
\vdots \\
\sum_{j=0}^nx^{(m)}_{j}\theta_j \\
\end{bmatrix}
-
\begin{bmatrix}
y^{(1)} \\
y^{(2)} \\
\vdots \\
y^{(m)} \\
\end{bmatrix}&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[
= \begin{bmatrix}
x^{(1)}_{0} &amp; x^{(1)}_{1} &amp; x^{(1)}_{2} &amp; \cdots &amp; x^{(1)}_{n} \\
x^{(2)}_{0} &amp; x^{(2)}_{1} &amp; x^{(2)}_{2} &amp; \cdots &amp; x^{(2)}_{n} \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
x^{(m)}_{0} &amp; x^{(m)}_{1} &amp; x^{(m)}_{2} &amp; \cdots &amp; x^{(m)}_{n} \\
\end{bmatrix}
\cdot
\begin{bmatrix}
\theta_0 \\
\theta_1 \\
\vdots \\
\theta_n \\
\end{bmatrix}
-
\begin{bmatrix}
y^{(1)} \\
y^{(2)} \\
\vdots \\
y^{(m)} \\
\end{bmatrix}
= X \cdot \theta - Y %]]&gt;&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;GRADIENT = 
\begin{bmatrix}
\frac{\partial}{\partial\theta_0}J(\theta) \\
\frac{\partial}{\partial\theta_1}J(\theta) \\
\vdots \\
\frac{\partial}{\partial\theta_n}J(\theta) \\
\end{bmatrix} 
=
\begin{bmatrix}
\sum_{i=1}^m(h_\theta(x^{(i)} - y^{(i)})x^{(i)}_{0} \\
\sum_{i=1}^m(h_\theta(x^{(i)} - y^{(i)})x^{(i)}_{1} \\
\vdots \\
\sum_{i=1}^m(h_\theta(x^{(i)} - y^{(i)})x^{(i)}_{n} \\
\end{bmatrix} 
=
\begin{bmatrix}
\sum_{i=1}^mloss^{(i)}x^{(i)}_{0} \\
\sum_{i=1}^mloss^{(i)}x^{(i)}_{1} \\
\vdots \\
\sum_{i=1}^mloss^{(i)}x^{(i)}_{n} \\
\end{bmatrix}&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[
= \begin{bmatrix}
x^{(1)}_{0} &amp; x^{(2)}_{0} &amp; \cdots &amp; x^{(m)}_{0} \\
x^{(1)}_{1} &amp; x^{(2)}_{1} &amp; \cdots &amp; x^{(m)}_{1} \\
\vdots \\
x^{(1)}_{n} &amp; x^{(2)}_{n} &amp; \cdots &amp; x^{(m)}_{n} \\
\end{bmatrix} 
\cdot
\begin{bmatrix}
loss^{(1)} \\
loss^{(2)} \\
\vdots \\
loss^{(m)} \\
\end{bmatrix}
= X^T \cdot LOSS %]]&gt;&lt;/script&gt;

&lt;p&gt;完整代码如下&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;numpy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;gd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1e-6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shape&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ones&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sse2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Xt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;transpose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;hypothesis&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hypothesis&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sse2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;sse2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;gradient&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Xt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gradient&lt;/span&gt;
        
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 取x_0 = 1&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;2.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;3.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;4.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;5.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;6.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;7.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;8.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;9.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.199&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.389&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.580&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.783&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.980&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.177&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.380&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.575&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.771&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.05&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1e-6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'y = {0} * x + {1}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# y = 0.193953964855 * x + 0.01615274985&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;最终实现&quot;&gt;最终实现&lt;/h3&gt;

&lt;p&gt;在上面的使用上，我们需要调用方主动为每一个$x_0$赋值为1，其实这一部分完全可以在算法里面实现，简化调用方的使用成本。&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;numpy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bgd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1e-8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;trace&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_X&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;column_stack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ones&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shape&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sse2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ones&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Xt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_X&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sse2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;sse2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;trace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[ Epoch {0} ] theta = {1}, loss = {2}, error = {3})&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cnt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;gradient&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Xt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gradient&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
        
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.99&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;3.89&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;5.80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;7.83&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;9.80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;11.77&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;13.80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;15.75&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;17.71&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.05&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1e-6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'y = {0} * x + {1}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
        <pubDate>Sun, 22 Oct 2017 23:00:00 +0000</pubDate>
        <link>http://localhost:4000/2017/10/22/gradient-descent-derivation.html</link>
        <guid isPermaLink="true">http://localhost:4000/2017/10/22/gradient-descent-derivation.html</guid>
        
        <category>ml</category>
        
        <category>mathematics</category>
        
        <category>algorithm</category>
        
        <category>python</category>
        
        
        <category>ml</category>
        
      </item>
    
      <item>
        <title>牛顿法从放弃到入门</title>
        <description>&lt;h3 id=&quot;问题&quot;&gt;问题&lt;/h3&gt;

&lt;p&gt;科学或工程问题的求解和模拟最终往往都要解决求根或优化问题，前一种情形要求出方程或方程组的解；后一种情形则要找出使函数取极大或极小值的点，即使是对实验数据进行拟合或数值求解微分方程，也总是将问题简化成上述两类问题。&lt;/p&gt;

&lt;p&gt;第一类问题本质是求出$f(x) = 0$的解，第二类问题则可以转化为求$g(x) = f^{‘}(x) = 0$的解，其实本质我们都可以转化为求解方程根的问题。&lt;/p&gt;

&lt;h3 id=&quot;对分法&quot;&gt;对分法&lt;/h3&gt;

&lt;p&gt;在解方程的问题上，我们最容易会想到就是通过对分法迭代逐步逼近方程的根，最终达到求解方程的根的目的。他的基本思想如下：&lt;/p&gt;

&lt;p&gt;如果$f$在所考虑的区间上连续，且$[x_0, x_1]$是有根区间，即$f(x_0) \cdot f(x_1) &amp;lt; 0$，则取&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;x_2 = \frac{x_0 + x_1}{2}&lt;/script&gt;

&lt;p&gt;并计算$f(x_2)$，如果$f(x_2) = 0$则结束，否则或者$f(x_2)$与$f(x_0)$符号相反，此时$[x_0, x_2]$是新的有根区间，长度为原来的一半，或者$f(x_2)$与$f(x_1)$符号相反，此时$[x_2, x_1]$是新的有根区间，长度也为原来的一半，不管哪种情形，都通过计算一个新的函数值（$f(x_2)$的计算）将零点$x^*$的不确定性降低了50%，接下来在新的区间上重复这一过程，直到有根区间的长度充分小。&lt;/p&gt;

&lt;p&gt;算法描述如下：&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;solve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;2.0&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;gx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'[ Epoch {0} ] guess = {1}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;gx0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gx1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gx0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;测试解方程&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 求解f(x) = x^2 - 5 = 0&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;solve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1e-8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [ Epoch 28 ] guess = 2.23606797867&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 2.23606797867&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 求解f(x) = x^2 - 2 = 0&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;solve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1e-8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [ Epoch 27 ] guess = 1.41421356052&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 1.41421356052&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可以看出求解$x^2 = 5$迭代了29次，求解$x^2 = 2$迭代了28次，具体的迭代次数与$[x_0, x_1]$的区间长度和精度$epsilon = 1e-8$有关，对于这样的收敛速度，实在是太慢了，通常需要几次迭代才可以增加一位正确的有效数字。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;如果对分法第n次的迭代的误差是$\epsilon$，那么为了使误差降低为$\frac{\epsilon}{10}$，即使结果增加一位正确的有效数字，则需要再迭代$m$次，$m = log_2(10) = 3.3219$。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;除此之外，对分法对初始区间$[x_0, x_1]$也有很高要求，需要保证该区间是有根区间。&lt;/p&gt;

&lt;p&gt;那么有没有对初始值要求不高，收敛速度更快的算法呢？答案是有的，它就是下文要重点分析的牛顿法。&lt;/p&gt;

&lt;h3 id=&quot;牛顿法&quot;&gt;牛顿法&lt;/h3&gt;

&lt;h4 id=&quot;算法描述&quot;&gt;算法描述&lt;/h4&gt;

&lt;p&gt;牛顿法（或称牛顿-拉弗森(Newton-Raphson)迭代）：对于可微函数$f$，选定一个点$x_0$，计算&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;x_1 = x_0 - \frac{f(x_0)}{f^{'}(x_0)}&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;x_2 = x_1 - \frac{f(x_1)}{f^{'}(x_1)}&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;x_3 = x_2 - \frac{f(x_2)}{f^{'}(x_2)}&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\vdots&lt;/script&gt;

&lt;p&gt;直到满足某个判停准则，最终得到的$x_k$为$f$零点的近似值。&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 根据导数公式求解函数g的导函数&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;derivative&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dx&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# 牛顿法代码实现&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;solve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'[ Epoch {0} ] guess = {1}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;derivative&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;测试解方程&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 求解f(x) = x^2 - 5 = 0&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;solve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1e-8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [ Epoch 4 ] guess = 2.23606889563&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 2.2360679775&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 求解f(x) = x^2 - 2 = 0&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;solve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1e-8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [ Epoch 0 ] guess = 2&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [ Epoch 1 ] guess = 1.49999999696&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [ Epoch 2 ] guess = 1.41666666616&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [ Epoch 3 ] guess = 1.41421568629&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 1.41421356237&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可以看出求解$x^2 = 5$只迭代了5次，求解$x^2 = 2$迭代了4次，收敛速度非常快。&lt;/p&gt;

&lt;h4 id=&quot;几何意义&quot;&gt;几何意义&lt;/h4&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# coding=UTF-8&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;numpy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;matplotlib.pyplot&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linspace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;colors&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'r-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'g-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'b-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'y-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'c-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'m-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'k-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'w-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'r-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'g-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'b-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'y-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'c-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'m-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'k-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'w-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 切线方程&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;tangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 求导函数&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;derivative&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dx&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 绘制牛顿法逼近过程&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;solve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'[ Epoch {0} ] guess = {1}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;derivative&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;colors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scatter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;square&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;square&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'k-'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;solve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;square&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1e-6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;grid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;输出：&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# [ Epoch 0 ] guess = 10&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [ Epoch 1 ] guess = 5.25000023439&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [ Epoch 2 ] guess = 3.10119077758&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [ Epoch 3 ] guess = 2.35673746512&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [ Epoch 4 ] guess = 2.23915725731&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [ Epoch 5 ] guess = 2.23607010927&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/newton_method_geometry.png&quot; alt=&quot;NewtonMethodGeometry&quot; /&gt;&lt;/p&gt;

&lt;p&gt;很容易看出，离零点越远的地方收敛速度越快，离零点越近的地方收敛速度越慢，每一次迭代，都比上一次的值更接近$f(x) = 0$。&lt;/p&gt;

&lt;h4 id=&quot;逼近序列的推导&quot;&gt;逼近序列的推导&lt;/h4&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;x_{n+1} = x_n - \frac{f(x_n)}{f^{'}(x_n)}&lt;/script&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/newton_method.png&quot; alt=&quot;NewtonMethod&quot; /&gt;&lt;/p&gt;

&lt;p&gt;通过上文中的几何意义，点$x_{n+1}$是$f(x)$在点$x_n$处的切线与$x$轴的交点，切线的直线方程为：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;y = f^{'}(x_n)(x - x_{n}) + f(x_n)&lt;/script&gt;

&lt;p&gt;令$y = 0$，很容易计算出&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;x = x_n - \frac{f(x_n)}{f^{'}(x_n)}&lt;/script&gt;

&lt;p&gt;我们可以根据&lt;a href=&quot;/2017/09/16/taylor-series-derivation.html&quot;&gt;泰勒公式&lt;/a&gt;的一阶展开来推导出该公式。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;f(x) \approx f(x_n) + f^{'}(x_n)(x - x_n) = 0&lt;/script&gt;

&lt;p&gt;可以直接得出&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;x = x_n - \frac{f(x_n)}{f^{'}(x_n)}&lt;/script&gt;

</description>
        <pubDate>Sun, 17 Sep 2017 23:00:00 +0000</pubDate>
        <link>http://localhost:4000/2017/09/17/newton-method-derivation.html</link>
        <guid isPermaLink="true">http://localhost:4000/2017/09/17/newton-method-derivation.html</guid>
        
        <category>ml</category>
        
        <category>mathematics</category>
        
        <category>algorithm</category>
        
        <category>python</category>
        
        
        <category>ml</category>
        
      </item>
    
      <item>
        <title>不动点迭代及其收敛性</title>
        <description>&lt;h3 id=&quot;什么是不动点迭代法&quot;&gt;什么是不动点迭代法&lt;/h3&gt;

&lt;p&gt;函数$f$的不动点是一个值$x$使得$f(x) = x$。例如，0和1是函数$f(x) = x^2$的不动点，因为$0^2 = 0$而$1^2 = 1$，即曲线$y = f(x)$与直线$y = x$存在交点$P(x^{\ast}, x^{\ast})$。&lt;/p&gt;

&lt;p&gt;对于某些函数，通过某些初始猜测出发，反复地应用$f$，&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;f(x), f(f(x)), f(f(f(x))),\cdots&lt;/script&gt;

&lt;p&gt;直到值的变化不大时，就可以找到它的一个不动点。&lt;/p&gt;

&lt;p&gt;算法描述如下：&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;solve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'[ Epoch {0} ] guess = {1}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;guess&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;下面示例演示了&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;求解$f(x) = \frac{x + \frac{5}{x}}{2} = x$也即求解$x^2=5$。&lt;/li&gt;
  &lt;li&gt;求解$f(x) = \frac{x + \frac{8}{x^2}}{2} = x$也即求解$x^3=8$。&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;solve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;10.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1e-8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [ Epoch 5 ] guess = 2.2360679775&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;solve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;10.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1e-8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [ Epoch 27 ] guess = 2.00000000337&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;不动点迭代法的收敛性&quot;&gt;不动点迭代法的收敛性&lt;/h3&gt;

&lt;p&gt;一般地，将非线性方程$f(x) = 0$化为一个同解方程&lt;/p&gt;

&lt;div&gt;$$ \varphi(x) = x　　　① $$&lt;/div&gt;

&lt;p&gt;并且假设$\varphi(x)$是一个连续函数，选定一个点$x_0$，计算&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;x_1 = \varphi(x_0)&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;x_2 = \varphi(x_1)&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;x_3 = \varphi(x_2)&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\vdots&lt;/script&gt;

&lt;div&gt;$$ \left. x_{k+1} = \varphi(x_k) \right|_{k \in (1, 2, 3,\cdots)}　　　② $$ &lt;/div&gt;

&lt;p&gt;②式为求解非线性方程①的迭代公式，$\varphi(x)$为迭代函数，$x_k$为第$k$步的迭代值。
如果存在一点$x^*$，使得序列${x_k}$满足，&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\lim_{k \to \infty} x_k = x^*&lt;/script&gt;

&lt;p&gt;称②式收敛，否则为发散。&lt;/p&gt;

&lt;p&gt;上例中，我们求解了方程$f(x) = x^2 - 5 = 0$，给出的同解方程是$\varphi(x) = \frac{x + \frac{5}{x}}{2} = x$和。&lt;/p&gt;

&lt;p&gt;为什么我们不使用更简单的$\varphi(x) = \frac{5}{x} = x$？答案是，因为它不收敛，它关于直线$y = x$对称，易得$x_1 = \varphi(x_0)$及$x_2 = \varphi(x_1) = x_0$，$x$值总在$x_0$和$\varphi(x_0)$之间摆动。&lt;/p&gt;

&lt;p&gt;一般地，我们有两种类型的收敛迭代。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/fixed_point_01.png&quot; alt=&quot;fixed_point_01&quot; /&gt;
&lt;img src=&quot;/assets/images/fixed_point_02.png&quot; alt=&quot;fixed_point_02&quot; /&gt;&lt;/p&gt;

&lt;p&gt;对应有两种类型的发散&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/fixed_point_03.png&quot; alt=&quot;fixed_point_03&quot; /&gt;
&lt;img src=&quot;/assets/images/fixed_point_04.png&quot; alt=&quot;fixed_point_04&quot; /&gt;&lt;/p&gt;

&lt;p&gt;通过观察我们发现，在曲线$y = \varphi(x)$与直线$y = x$交点$P(x^{\ast}, x^{\ast})$处，$x^{\ast}$对应的曲线切线斜率的绝对值小于1（y=x的斜率）时，迭代收敛。一旦交点对应的曲线切线的斜率大于1，迭代就会无法收敛。&lt;/p&gt;

&lt;p&gt;$\varphi(x)$要收敛，必须满足如下不动点定理。&lt;/p&gt;

&lt;p&gt;设迭代函数$\varphi(x)$在区间$[a, b]$上连续，且满足&lt;/p&gt;

&lt;p&gt;(1). 当$x \in [a, b]$时，$a \leq \varphi(x) \leq b$；&lt;/p&gt;

&lt;p&gt;(2). 存在一正数$L$，满足$0 &amp;lt; L &amp;lt; 1$，且$\forall x \in [a, b]$，有&lt;/p&gt;
&lt;div&gt;$$ \left| \varphi^{'}(x) \right| \leq L $$&lt;/div&gt;

&lt;p&gt;则：&lt;/p&gt;

&lt;p&gt;a). 方程$\varphi(x) = x$在$[a, b]$内有唯一解$x^*$&lt;/p&gt;

&lt;p&gt;b). 对于任意初值$x_0 \in [a, b]$，迭代法$x_{k+1} = \varphi(x_k)$均收敛于$x^{\ast}$&lt;/p&gt;

&lt;p&gt;c). &lt;span&gt;$\left| x_k - x^* \right| \leq \frac{L}{1 - L}\left| x_k - x_{k - 1} \right|$&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;d). &lt;span&gt;$\left| x_k - x^* \right| \leq \frac{L^k}{1 - L}\left| x_1 - x_0 \right|$&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;证明过程如下：&lt;/p&gt;

&lt;p&gt;设 $f(x) = x - \varphi(x)$，则$f(x)$在[a, b]上连续可导，根据条件(1)，&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;f(a) = a - \varphi(a) \leq 0&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;f(b) = b - \varphi(b) \geq 0&lt;/script&gt;

&lt;p&gt;由根的存在定理，方程$f(x) = 0$在$[a, b]$上至少存在一个根(存在性)。&lt;/p&gt;

&lt;p&gt;根据条件(2)，&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[
\left|\varphi^{'}(x)\right| \leq L &lt; 1 %]]&gt;&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;f^{'}(x) = 1 - \varphi^{'}(x) &gt; 0&lt;/script&gt;

&lt;p&gt;则函数$f(x)$在$[a, b]$上单调递增，a).方程$f(x) = 0$在$[a, b]$内有唯一解$x^{\ast}$(唯一性)&lt;/p&gt;

&lt;p&gt;由微分中值定理&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;x_{k+1} - x^{\ast} = \varphi(x_k) - \varphi(x^{\ast}) = \varphi^{'}(\xi)(x_{k} - x^{\ast})&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;x_{k+1} - x_k = \varphi(x_k) - \varphi(x_{k-1}) = \varphi^{'}(\overline \xi)(x_{k} - x_{k-1})&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\varphi^{'}(x) \leq L&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\implies \left| x_{k + 1} - x^{\ast} \right| \leq L \left| x_k - x^{\ast} \right| = L \left| x_{k + 1} - x^{\ast} - (x_{k + 1} - x_k) \right| \leq  L \left| x_{k + 1} - x^{\ast} \right| + L \left| x_{k + 1} - x_k \right|&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\implies c). \left| x_{k + 1} - x^{\ast} \right| \leq \frac{L}{1-L}\left| x_{k + 1} - x_k \right|&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\implies d). \left| x_{k + 1} - x^{\ast} \right| \leq \frac{L^k}{1-L}\left| x_1 - x_0 \right|&lt;/script&gt;

&lt;p&gt;即&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\left| x_{k + 1} - x^{\ast} \right| \leq \frac{L}{1-L}\left| x_{k + 1} - x_k \right| \leq \frac{L^k}{1-L}\left| x_1 - x_0 \right|&lt;/script&gt;

&lt;p&gt;因为$L &amp;lt; 1$, 因此对于任意初值$x_0$，迭代法$x_{k+1} = \varphi(k)$均收敛于$x^{\ast}$。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\lim_{k \to \infty}(x_k - x^{\ast}) = 0&lt;/script&gt;

&lt;!-- $\varphi(x) = \frac{5}{x}$的导函数为$\varphi^{'}(x) = -\frac{5}{x^2} &lt; 0$，不满足条件(2)，因此它不收敛。同样$\varphi(x) = \frac{8}{x^2}$的导函数为$\varphi^{'}(x) = -\frac{16}{x^3}$。 --&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;category&lt;/th&gt;
      &lt;th&gt;count&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;spam&lt;/td&gt;
      &lt;td&gt;count1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$\overline{spam}$&lt;/td&gt;
      &lt;td&gt;count2&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;word&lt;/th&gt;
      &lt;th&gt;category&lt;/th&gt;
      &lt;th&gt;count&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_1$&lt;/td&gt;
      &lt;td&gt;spam&lt;/td&gt;
      &lt;td&gt;$w_1c_1$&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_1$&lt;/td&gt;
      &lt;td&gt;$\overline{spam}$&lt;/td&gt;
      &lt;td&gt;$w_1c_2$&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_2$&lt;/td&gt;
      &lt;td&gt;spam&lt;/td&gt;
      &lt;td&gt;$w_2c_1$&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_2$&lt;/td&gt;
      &lt;td&gt;$\overline{spam}$&lt;/td&gt;
      &lt;td&gt;$w_2c_2$&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;…&lt;/td&gt;
      &lt;td&gt;…&lt;/td&gt;
      &lt;td&gt;…&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_n$&lt;/td&gt;
      &lt;td&gt;spam&lt;/td&gt;
      &lt;td&gt;$w_nc_1$&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_n$&lt;/td&gt;
      &lt;td&gt;$\overline{spam}$&lt;/td&gt;
      &lt;td&gt;$w_nc_1$&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
</description>
        <pubDate>Sat, 16 Sep 2017 23:00:00 +0000</pubDate>
        <link>http://localhost:4000/2017/09/16/fixed-point-iteration.html</link>
        <guid isPermaLink="true">http://localhost:4000/2017/09/16/fixed-point-iteration.html</guid>
        
        <category>ml</category>
        
        <category>mathematics</category>
        
        <category>algorithm</category>
        
        <category>python</category>
        
        
        <category>ml</category>
        
      </item>
    
      <item>
        <title>泰勒级数从放弃到入门</title>
        <description>&lt;h2 id=&quot;知识准备&quot;&gt;知识准备&lt;/h2&gt;

&lt;h4 id=&quot;极限&quot;&gt;极限&lt;/h4&gt;

&lt;p&gt;&lt;span&gt;设函数$f(x)$在点$x_0$的某一去心邻域内有定义，如果存在常数$a$，对于任意给定的正数$\epsilon$，总存在正数$\delta$，使得当$x$满足不等式$0 &amp;lt; |x - x_0| &amp;lt; \delta$时，对应的函数值$f(x)$都满足不等式$|f(x) - a| &amp;lt; \epsilon$，那么常数$a$就叫做函数$f(x)$当$x \to x_0$时的极限，记作：&lt;/span&gt;&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\lim_{x \to x_0} f(x) = a&lt;/script&gt;

&lt;h4 id=&quot;导数&quot;&gt;导数&lt;/h4&gt;
&lt;p&gt;设函数$y = f(x)$在点$x_)$的某个邻域内有定义，当自变量$x$在$x_0$处取得增量$\Delta x$（点$x_0 + \Delta x$仍在该邻域内）时，相应地函数$y$取得增量$\Delta y = f(x) - f(x_0)$；如果$\Delta y$与$\Delta x$之比当$\Delta x \to 0$时的极限存在，则称函数$y = f(x)$在点$x_0$处可导，并称这个极限为函数$y = f(x)$在点$x_0$处的导数，记为：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;f^{'}(x_0) = y^{'}|_{x=x_0} = \left. \frac{dy}{dx} \right|_{x=x_0} = \lim_{\Delta x \to 0} \frac{\Delta y}{\Delta x} = \lim_{\Delta x \to 0} \frac{f(x_0 + \Delta x) - f(x_0)}{\Delta x} = \lim_{x \to x_0} \frac{f(x) - f(x_0)}{x - x_0}&lt;/script&gt;

&lt;h4 id=&quot;函数极限和无穷小的关系&quot;&gt;函数极限和无穷小的关系&lt;/h4&gt;
&lt;p&gt;在自变量$x$的同一变化过程$x \to x_0$(或$x \to \infty$)中，函数$f(x)$具有极限A的充分必要条件$f(x) = A + a$，其中$a$是无穷小。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\lim_{x \to x_0} f(x) = A \iff f(x) = A + a|_{a -&gt; 0}&lt;/script&gt;

&lt;h4 id=&quot;洛必达法则&quot;&gt;洛必达法则&lt;/h4&gt;

&lt;p&gt;洛必达法则是在一定条件下通过分子分母分别求导再求极限来确定未定式值的方法。&lt;/p&gt;

&lt;h5 id=&quot;00型不定式极限&quot;&gt;$0/0$型不定式极限&lt;/h5&gt;

&lt;p&gt;若函数$f(x)$和$g(x)$满足下列条件：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;$\lim_{x \to a} f(x) = 0, \lim_{x \to a} g(x) = 0$;&lt;/li&gt;
  &lt;li&gt;在点$a$的某去心邻域内两者都可导，且$g^{‘}(x) \not= 0$;&lt;/li&gt;
  &lt;li&gt;$\lim_{x \to a} \frac{f^{‘}(x)}{g^{‘}(x)} = A$(A可为实数，也可为$\pm \infty$)。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;则&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\lim_{x \to a} \frac{f(x)}{g(x)} = \lim_{x \to a} \frac{f^{'}(x)}{g^{'}(x)} = A&lt;/script&gt;

&lt;h5 id=&quot;inftyinfty型不定式极限&quot;&gt;$\infty/\infty$型不定式极限&lt;/h5&gt;

&lt;p&gt;若函数$f(x)$和$g(x)$满足下列条件：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;$\lim_{x \to a} f(x) = \infty, \lim_{x \to a^+} g(x) = \infty$;&lt;/li&gt;
  &lt;li&gt;在点$a$的某去心邻域内两者都可导，且$g^{‘}(x) \not= 0$;&lt;/li&gt;
  &lt;li&gt;$\lim_{x \to a^+} \frac{f^{‘}(x)}{g^{‘}(x)} = A$(A可为实数，也可为$\pm \infty 或 \infty$)。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;则&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\lim_{x \to a^+} \frac{f(x)}{g(x)} = \lim_{x \to a^+} \frac{f^{'}(x)}{g^{'}(x)} = A&lt;/script&gt;

&lt;h2 id=&quot;泰勒级数&quot;&gt;泰勒级数&lt;/h2&gt;

&lt;h4 id=&quot;定义&quot;&gt;定义&lt;/h4&gt;

&lt;p&gt;设$n$是一个正整数。如果定义在一个包含$a$的区间上的函数$f$在$a$点处$n - 1$次可导，那么对于这个区间上的任意$x$都有：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;f(x) = \sum_{k = 0}^{n - 1} \frac{f^{(k)}(a)}{k!}(x - a)^k + R_n(x)&lt;/script&gt;

&lt;p&gt;其中的多项式称为函数在$a$出的泰勒展开式，$R_n(x)$是泰勒公式的余项且是$(x - a)^n$的高阶无穷小。&lt;/p&gt;

&lt;p&gt;泰勒公式是在局部，用一个多项式函数，近似地替代一个复杂函数。泰勒展开式与$f(x)$的每一阶导数值完全相等，而这种“各阶导数值相等”揭示了多项式函数和他要替代的复杂函数$f(x)$在每一个维度$(1,x,x^2,\cdots,x^{n-1})$上完全相同的事实。&lt;/p&gt;

&lt;h4 id=&quot;推导过程&quot;&gt;推导过程&lt;/h4&gt;

&lt;p&gt;假设函数$f(x)$在点$a$的邻域内有定义，且在点$a$处$n - 1$次可导。&lt;/p&gt;

&lt;p&gt;根据导数定义及函数极限与无穷小的关系，易得：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;f^{'}(x_0) = \lim_{\Delta x \to 0} \frac{\Delta y}{\Delta x} \implies \frac{\Delta y}{\Delta x} = \left. f^{'}(x_0) + a_1 \right|_{a_1 \to 0}&lt;/script&gt;

&lt;p&gt;给定点$x_0$邻域中的点$x$，$\Delta y = f(x) - f(x_0), \Delta x = x - x_0$，则有公式①&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;f(x) = f(x_0) + f^{'}(x_0)\Delta x + a_1 \Delta x&lt;/script&gt;

&lt;p&gt;比较无穷小量$a_1$和$\Delta x$的关系。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;a_1 = \frac{f(x) - f(x_0) - f^{'}(x_0)(x - x_0)}{x - x_0} \implies \lim_{\Delta x \to 0} \frac{a_1}{\Delta x} = \lim_{x \to x_0} \frac{f(x) - f(x_0) - f^{'}(x_0)(x - x_0)}{(x - x_0)^2}&lt;/script&gt;

&lt;p&gt;根据$0/0$洛必达法则&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\lim_{\Delta x \to 0} \frac{a_1}{\Delta x} = \lim_{x \to x_0} \frac{f^{'}(x) - f^{'}(x_0)}{2(x - x_0)} = \frac{1}{2}f^{''}(x_0)&lt;/script&gt;

&lt;p&gt;根据极限与无穷小的关系，得到：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\frac{a_1}{\Delta x} = \left. \frac{1}{2}f^{''}(x_0) + a_2 \right|_{a_2 \to 0}&lt;/script&gt;

&lt;p&gt;代入公式①，得到公式②：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;f(x) = f(x_0) + f^{'}(x_0)\Delta x + \frac{1}{2}f^{''}(x_0)\Delta^2 x + a_2\Delta^2 x&lt;/script&gt;

&lt;p&gt;同理，可以求得&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;a_2 = \frac{f(x) - f(x_0) - f^{'}(x_0) \Delta x - \frac{1}{2}f^{''}(x_0)\Delta^2 x}{\Delta^2 x}&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\implies \lim_{\Delta x \to 0} \frac{a_2}{\Delta x} = \lim_{x \to x_0} \frac{f(x) - f(x_0) - f^{'}(x_0)(x - x_0) - \frac{1}{2}f^{''}(x_0)(x - x_0)^2}{(x - x_0)^3}&lt;/script&gt;

&lt;p&gt;连续应用洛必达法则可得：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\lim_{\Delta x \to 0} \frac{a_2}{\Delta x} = \lim_{x \to x_0} \frac{f^{'}(x) - f^{'}(x_0) - f^{''}(x_0)(x - x_0)}{3(x - x_0)^2} = \lim_{x \to x_0} \frac{f^{''}(x) - f^{''}(x_0)}{3!(x - x_0)} = \frac{1}{3!} f^{'''}(x_0)&lt;/script&gt;

&lt;p&gt;&lt;span&gt;把$a_2 = \left. (\frac{1}{3!}f^{‘’’}(x_0) + a_3)\Delta x \right|_{a_3 \to 0}$代入公式②，得到公式③：&lt;/span&gt;&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;f(x) = f(x_0) + f^{'}(x_0)\Delta x + \frac{1}{2!}f^{''}(x_0)\Delta^2 x + \frac{1}{3!}f^{'''}(x_0) \Delta^3 x + a_3\Delta^3 x&lt;/script&gt;

&lt;p&gt;以此类推，根据数学归纳法，易证明泰勒公式最后结论。&lt;/p&gt;

&lt;h4 id=&quot;应用&quot;&gt;应用&lt;/h4&gt;

&lt;p&gt;在数值计算方面，利用多项式函数近似、去逼近一个复杂函数，是研究实际问题的一个非常重要的方式，也即是把质的困难转化为量的复杂。比如$e$和$\pi$的计算，机器学习中的优化算法当中，也大量利用到了泰勒公式。&lt;/p&gt;

&lt;h5 id=&quot;数值计算&quot;&gt;数值计算&lt;/h5&gt;

&lt;p&gt;$ e^x \approx 1 + x + \frac{x^2}{2!} + \frac{x^3}{3!} +  \cdots + \frac{x^n}{n!} $&lt;/p&gt;

&lt;p&gt;$ \frac{\pi}{4} \approx \sum_{i=0}^n \frac{(-1)^i}{2 \cdot i + 1}$&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;factorial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Count e&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;factorial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)])&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;     &lt;span class=&quot;c&quot;&gt;# 2.71828182846&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Count π 这个公式收敛很慢&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pi&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;power&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)])&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pi&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;# 3.14159165359&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;渐进演示&quot;&gt;渐进演示&lt;/h5&gt;

&lt;p&gt;利用泰勒级数展开逼近$e^x$&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;matplotlib.pyplot&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;numpy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;factorial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;power&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;factorial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;taylor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)])&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linspace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;grid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;taylor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'r:'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;# 红色&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;taylor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'g:'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;# 绿色&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;taylor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'b-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# 蓝色&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;taylor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'m--'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# 紫红色&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;taylor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'y-.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# 黄色&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'k:'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;                    &lt;span class=&quot;c&quot;&gt;# 黑色&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/taylor_as_e.png&quot; alt=&quot;TaylorAsEX&quot; /&gt;&lt;/p&gt;

</description>
        <pubDate>Sat, 16 Sep 2017 21:00:00 +0000</pubDate>
        <link>http://localhost:4000/2017/09/16/taylor-series-derivation.html</link>
        <guid isPermaLink="true">http://localhost:4000/2017/09/16/taylor-series-derivation.html</guid>
        
        <category>ml</category>
        
        <category>mathematics</category>
        
        <category>algorithm</category>
        
        <category>python</category>
        
        
        <category>ml</category>
        
      </item>
    
      <item>
        <title>朴素贝叶斯从放弃到入门</title>
        <description>&lt;h2 id=&quot;理论基础&quot;&gt;理论基础&lt;/h2&gt;

&lt;h3 id=&quot;联合概率&quot;&gt;联合概率&lt;/h3&gt;

&lt;p&gt;联合概率表示两个事件共同发生的概率。A与B的联合概率表示为$P(AB)$，$P(A,B)$或者$P(A \bigcap B)$。&lt;/p&gt;

&lt;p&gt;联合概率可以推广到任意又穷多个事件出现的情况，设（$A_1,A_2,\cdots,A_n$）为任意n个事件（$n\ge2$），事件$A_1,A_2,\cdots,A_n$共同发生的概率记为$P(A_1A_2 \dots A_n)$，$P(A_1,A_2,\dots,A_n)$或者$P(A_1 \bigcap A_2 \bigcap \dots \bigcap A_n)$&lt;/p&gt;

&lt;h3 id=&quot;条件概率&quot;&gt;条件概率&lt;/h3&gt;

&lt;p&gt;&lt;span&gt;设A，B 是两个事件，且$P(A) &amp;gt; 0$，则称$P(B|A) = \frac{P(AB)}{P(A)}$为在事件A发生的条件下，事件B发生的条件概率。一般地，$P(B|A) \not= P(B)$ ，且它满足以下三条件：（1）非负性；（2）规范性；（3）可列可加性。&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;设E为随机试验，Ω为样本空间，A，B为任意两个事件，设$P(A)&amp;gt;0$，称$P(B|A) = \frac{P(AB)}{P(A)}$为在事件A发生的条件下事件B的条件概率。&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;上述乘法公式可推广到任意有穷多个事件时的情况。
&lt;span&gt;设（$A_1,A_2,\cdots,A_n$）为任意n个事件（$n\ge2$）且$P(A_1,A_2,\cdots,A_n)&amp;gt;0$，则$P(A_1A_2 \cdots A_n)=P(A_1)P(A_2|A_1) \cdots P(A_n|A_1A_2 \cdots A_{n-1}) = \prod_{i=1}^n P(A_i|A_1 \cdots A_{i-1})$。&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;对于一段文本序列$S=w_1,w_2,\cdots,w_n$，它的概率可表示为：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P(S) = P(w_1,w_2,\cdots,w_n) = \prod_{t=1}^n(w_t|w_1 \cdots w_{t-1}) = P(w_1) \cdot P(w_2|w_1) \cdot P(w_3|w_1w_2) \cdots P(w_n|w_1w_2 \cdots w_{n-1})&lt;/script&gt;

&lt;h4 id=&quot;ngram模型&quot;&gt;Ngram模型&lt;/h4&gt;

&lt;p&gt;1.Ngram模型&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;script type=&quot;math/tex&quot;&gt;P(w_t|w_1w_2 \cdots w_{t-1}) \approx P(w_t|w_{t-n+1} \cdots w_{t-1})&lt;/script&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;2.bigram&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;script type=&quot;math/tex&quot;&gt;P(w_t|w_1w_2 \cdots w_{t-1}) \approx P(w_t|w_{t-1})&lt;/script&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;3.trigram&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;script type=&quot;math/tex&quot;&gt;P(w_t|w_1w_2 \cdots w_{t-1}) \approx P(w_t|w_{t-1}w_{t-2})&lt;/script&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h4 id=&quot;独立性假设&quot;&gt;独立性假设&lt;/h4&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P(S) = P(w_1,w_2,\cdots,w_n) \approx \prod_{t=1}^T P(w_t) = P(w_1)P(w_2) \cdots P(w_n)&lt;/script&gt;

&lt;h4 id=&quot;其他&quot;&gt;其他&lt;/h4&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;先验概率 = P(原因)；后验概率 = P(原因|结果)&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P(a,b|c) = \frac{P(a,b,c)}{P(c)} = \frac{P(a,b,c)}{P(b,c)} \cdot \frac{P(b,c)}{P(c)} = P(a|b,c) \cdot P(b|c)&lt;/script&gt;

&lt;h3 id=&quot;完备事件组样本空间的划分&quot;&gt;完备事件组/样本空间的划分&lt;/h3&gt;

&lt;p&gt;设（$A_1,\cdots,A_i,\cdots,A_n$）是一组事件，若&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;$\forall_{i\not=j} A_i \bigcap A_j = \emptyset; i,j\in(1,2,\cdots,n)$&lt;/li&gt;
  &lt;li&gt;$\sum_{i=1}^n A_i = \Omega$&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;则称（$A_1,\cdots,A_i,\cdots,A_n$）是样本空间Ω的一个划分，或称为样本空间Ω 的一个完备事件组。&lt;/p&gt;

&lt;h3 id=&quot;全概率公式&quot;&gt;全概率公式&lt;/h3&gt;

&lt;p&gt;&lt;span&gt;设（$A_1,\cdots,A_i,\cdots,A_n$）施一个完备事件组，则有$P(B) = \sum_{i=1}^n P(A_i) \cdot P(B|A_i) = \sum_{i=1}^n P(A_iB)$&lt;/span&gt;&lt;/p&gt;

&lt;h3 id=&quot;贝叶斯公式&quot;&gt;贝叶斯公式&lt;/h3&gt;

&lt;p&gt;设（$A_1,\cdots,A_i,\cdots,A_n$）是一组完备事件组，则有&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P(A_i|B) = \frac{PA_iB}{P(B)} = \frac{P(A_i)P(B|A_i)}{\sum_{j=1}^nP(A_j)P(B|A_j)}&lt;/script&gt;

&lt;p&gt;根据条件概率和全概率公式，很容易得出贝叶斯公式。&lt;/p&gt;

&lt;h2 id=&quot;贝叶斯定理的应用&quot;&gt;贝叶斯定理的应用&lt;/h2&gt;

&lt;h3 id=&quot;贝叶斯定理在艾滋病检测上的应用&quot;&gt;贝叶斯定理在艾滋病检测上的应用&lt;/h3&gt;

&lt;p&gt;假设艾滋病在人群中的发病率为万分之一，艾滋病检测假阴性的概率千分之一（假阴性的意思是本来有病应该呈现阳性，但是呈现了阴性）；艾滋病检测假阳性的概率为万分之一（假阳性意思是本来没病应该呈现阴性，但是呈现了阳性）。假设某人在某次检测当中结果呈现阳性，那么他真正感染艾滋病的概率是多少？&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 艾滋病在人群中的发病概率P(T)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.0001&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 在有艾滋病的场景下，检测为阳性的概率P(检测为阳性|患病)，即1-P(假阴性)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.999&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 在没有艾滋病的场景下，检测为阳性的概率P(检测为阳性|不患病)，即假阳性&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f_T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.0001&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div&gt;
根据贝叶斯公式，检测为阳性，感染艾滋病的概率

$$P(患病|检测为阳性) = \frac{P(检测为阳性|患病) \cdot P(患病)}{P(检测为阳性)}$$

$$P(检测为阳性)= P(检测为阳性|患病) \cdot P(患病) + P(检测为阳性|不患病) \cdot P(不患病)$$
&lt;/div&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bayes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pfT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pf_T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pfT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pfT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pf_T&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bayes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pfT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pf_T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span&gt;将数据代入公式，计算得出P(患病|检测为阳性)=49.977%，看起来还是不能确定该被试是否感染艾滋病（被试的感染艾滋病的几率从万分之一上升到近50%）。为了确定被试是否真正感染艾滋病，我们只需再进行一次检测，如果下一次检测还呈阳性，再一次应用贝叶斯定理，则该被试感染艾滋病的几率瞬间提升到99.99%，基本可以确定该被试感染艾滋病了。&lt;/span&gt;&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;pT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;49.977&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bayes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pfT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pf_T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 0.999899817803&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;贝叶斯定理在垃圾邮件过滤上的应用&quot;&gt;贝叶斯定理在垃圾邮件过滤上的应用&lt;/h3&gt;

&lt;p&gt;给定训练集，垃圾邮件和正常邮件各5000封，假定词$w_1$，$w_2$出现的频率如下。&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;词&lt;/th&gt;
      &lt;th&gt;邮件类别&lt;/th&gt;
      &lt;th&gt;词在该邮件类别中的数量&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_1$&lt;/td&gt;
      &lt;td&gt;Spam&lt;/td&gt;
      &lt;td&gt;250&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_1$&lt;/td&gt;
      &lt;td&gt;Health&lt;/td&gt;
      &lt;td&gt;5&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_2$&lt;/td&gt;
      &lt;td&gt;Spam&lt;/td&gt;
      &lt;td&gt;495&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_2$&lt;/td&gt;
      &lt;td&gt;Health&lt;/td&gt;
      &lt;td&gt;5&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# P(垃圾邮件)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# P(正常邮件)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pH&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pS&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 0.5&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# P(w1|垃圾邮件)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pw1S&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;250.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5000&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 0.05&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# P(w1|正常邮件)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pw1H&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;5.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5000&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 0.001&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span&gt;根据贝叶斯定理，我们很容易计算$P(垃圾邮件|w_1)$的概率。&lt;/span&gt;&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bayes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pwS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pwH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pwS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pwS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pwH&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# P(垃圾邮件|w1)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pSw1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bayes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pw1S&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pw1H&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 0.980392156863&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;其实根据样本分布，我们也很容易计算&lt;b&gt;$P(垃圾邮件|w_1)$&lt;/b&gt;的概率。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P(垃圾邮件|w_1) = \frac{P(w_1,垃圾邮件)}{P(w_1)} = \frac{250}{250 + 5} = 98.04%&lt;/script&gt;

&lt;p&gt;我们可以看出样本中包含$w_1$的邮件是垃圾邮件的概率超过98%，如果样本的分布和总体的分布一致，可以看出$w_1$的推断能力很强，尽管如此，我们依然不能根据单个词来明确的判断一封包含$w_1$的新邮件就是垃圾邮件。我们需要更多的证据。&lt;/p&gt;

&lt;p&gt;一封邮件由多个词组成，如果一封邮件不只是包含$w_1$，还包含$w_2$，那么这封邮件的是垃圾概率是多少呢。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P(垃圾邮件|w_1,w_2) = \frac{P(垃圾邮件,w_1,w_2)}{P(w_1,w_2)}&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P(w_1,w_2) = P(w_1,w_2|垃圾邮件) \cdot P(垃圾邮件) + P(w_1,w_2|正常邮件) \cdot P(正常邮件)&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;= P(w_1,w_2,垃圾邮件) + P(w_1,w_2,正常邮件)&lt;/script&gt;

&lt;p&gt;也即：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P(垃圾邮件|w_1,w_2) = \frac{P(垃圾邮件,w_1,w_2)}{P(w_1,w_2,垃圾邮件) + P(w_1,w_2,正常邮件)}&lt;/script&gt;

&lt;p&gt;这里涉及两个联合概率事件。&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;已知$w_1$，$w_2$的情况下，该邮件是垃圾邮件的概率，即$P(w_1,w_2,垃圾邮件)$，记为 $E_1$。&lt;/li&gt;
  &lt;li&gt;已知$w_1$，$w_2$的情况下，该邮件是正常邮件的概率，即$P(w_1,w_2,正常邮件)$，记为 $E_2$。&lt;/li&gt;
&lt;/ol&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;事件&lt;/th&gt;
      &lt;th&gt;$w_1$&lt;/th&gt;
      &lt;th&gt;$w_2$&lt;/th&gt;
      &lt;th&gt;垃圾邮件&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;$E_1$&lt;/td&gt;
      &lt;td&gt;出现&lt;/td&gt;
      &lt;td&gt;出现&lt;/td&gt;
      &lt;td&gt;是&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$E_2$&lt;/td&gt;
      &lt;td&gt;出现&lt;/td&gt;
      &lt;td&gt;出现&lt;/td&gt;
      &lt;td&gt;不是&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P(E_1) = P(w_1,w_2,垃圾邮件) = P(垃圾邮件) * P(w_1|垃圾邮件) * P(w_2|垃圾邮件,w_1)&lt;/script&gt;

&lt;p&gt;然而&lt;b&gt;$P(w_2|垃圾邮件,w_1)$&lt;/b&gt;该怎么计算呢？现在是朴素贝叶斯出场的时候了，基于独立性假设，$w_1$，$w_2$之间相互独立。则有：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P(w_2|垃圾邮件,w_1) = P(w_2|垃圾邮件)&lt;/script&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# P(S,w1,w2) = P(S) * P(w1|S) * P(w2|S,w1)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Independence hypothesis =&amp;gt; P(S,w1,w2) = P(S) * P(w1|S) * P(w2|S)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;joint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pw1S&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pw2S&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pw1S&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pw2S&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span&gt;$P(E_1) = P(垃圾邮件) * P(w_1|垃圾邮件) * P(w_2|垃圾邮件)$&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;$P(E_2) = P(正常邮件) * P(w_1|正常邮件) * P(w_2|正常邮件)$&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;目标概率：$P(垃圾邮件|w_1,w_2) = \frac{P(E_1)}{P(E_1) + P(E_2)}$&lt;/span&gt;&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# P(w2|垃圾邮件)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ps2W&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;495.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5000&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 0.001&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# P(w2|正常邮件) &lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pw2H&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;5.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5000&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 0.099&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# P(E1)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pE1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;joint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pw1S&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pw2S&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 0.002475&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pE2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;joint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pw1H&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pw2H&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 5e-07&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# P(垃圾邮件|w_1,w_2)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pE1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pE1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pE2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 0.999798020602&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;黑客与画家中的疑问&quot;&gt;黑客与画家中的疑问&lt;/h3&gt;

&lt;p&gt;Paul Graham在他的《黑客与画家》当中，有举过朴素贝叶斯的例子，他的做法是选出区分度最高的15个词，并计算其联合概率，并给出了最终公式。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P_{spam|w_1,w_2,\cdots,w_{15}} = \frac{\prod_{i=1}^{15} P_{spam|w_i}}{\prod_{i=1}^{15} P_{spam|w_i} + \prod_{i=1}^{15} (1 - P_{spam|w_i})}&lt;/script&gt;

&lt;p&gt;那么这个公式是怎么推导出来的呢？为了方便，我们取$w_1$，$w_2$两个词来尝试推导出这个公式，简化以后，公式变为：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P_{spam|w_1,w_2} = \frac{P_{spam|w_1} \cdot P_{spam|w_2}}{P_{spam|w_1} \cdot P_{spam|w_2} + (1 - P_{spam|w_1}) \cdot (1 - P_{spam|w_2})}&lt;/script&gt;

&lt;p&gt;下面我们开始推导过程。&lt;/p&gt;

&lt;p&gt;根据贝叶斯定理有：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P_{spam|w_1,w_2} = \frac{P_{w_1,w_2|spam} \cdot P_{spam}}{P_{w_1,w_2}} = \frac{P_{w_1,w_2|spam} \cdot P_{spam}}{P_{w_1,w_2|spam} \cdot P_{spam} + P_{w_1,w_2|\overline{spam}} \cdot P_{\overline{spam}}}&lt;/script&gt;

&lt;p&gt;&lt;span&gt;根据独立性假设$P_{w_1,w_2|spam} = P_{w_1|w_2,spam} \cdot P_{w_2|spam} = P_{w_1|spam} \cdot P_{w_2|spam}$，得到：&lt;/span&gt;&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P_{spam|w_1,w_2} \approx \frac{P_{w_1|spam} \cdot P_{w_2|spam} \cdot P_{spam}}{P_{w_1|spam} \cdot P_{w_2|spam} \cdot P_{spam} + P_{w_1|\overline{spam}} \cdot P_{w_2|\overline{spam}} \cdot P_{\overline{spam}}}&lt;/script&gt;

&lt;p&gt;&lt;span&gt;根据贝叶斯公式$P_{w|S} = \frac{P_{S|w} \cdot P_w}{P_S}$，得到：&lt;/span&gt;&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P_{spam|w_1,w_2} \approx \frac{P_{spam|w_1} \cdot P_{w_1} \cdot P_{spam|w_2} \cdot P_{w_2}}{P_{spam|w_1} \cdot P_{w_1} \cdot P_{spam|w_2} \cdot P_{w_2} + \frac{P_{\overline{spam}|w_1} \cdot P_{w_1} \cdot P_{\overline{spam}|w_2} \cdot P_{w_2} \cdot P_{spam}}{P_{\overline{spam}}}}&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;= \frac{P_{spam|w_1} \cdot P_{spam|w_2}}{P_{spam|w_1} \cdot P_{spam|w_2} + \frac{P_{\overline{spam}|w_1} \cdot P_{\overline{spam}|w_2} \cdot P_{spam}}{P_{\overline{spam}}}}&lt;/script&gt;

&lt;p&gt;&lt;span&gt;取$P_{spam}=P_{\overline{spam}}=0.5$，得到：&lt;/span&gt;&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P_{spam|w_1,w_2} \approx \frac{P_{spam|w_1} \cdot P_{spam|w_2}}{P_{spam|w_1} \cdot P_{spam|w_2} + P_{\overline{spam}|w_1} \cdot P_{\overline{spam}|w_2}}&lt;/script&gt;

&lt;p&gt;又因为：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P_{\overline{spam}|w} = \frac{P_{w|\overline{spam}} \cdot P_{\overline{spam}}}{P_w} = \frac{P_{w|\overline{spam}} \cdot P_{\overline{spam}}}{P_{w|\overline{spam}} \cdot P_{\overline{spam}} + P_{w|spam} \cdot P_{spam}}&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;= 1 - \frac{P_{w|spam} \cdot P_{spam}}{P_{w|\overline{spam}} \cdot P_{\overline{spam}} + P_{w|spam} \cdot P_{spam}} = 1 - P_{spam|w}&lt;/script&gt;

&lt;p&gt;最终可得：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P_{spam|w_1,w_2} = \frac{P_{spam|w_1} \cdot P_{spam|w_2}}{P_{spam|w_1} \cdot P_{spam|w_2} + (1 - P_{spam|w_1}) \cdot (1 - P_{spam|w_2})}&lt;/script&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;pSw1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bayes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pw1S&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pw1H&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pSw2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bayes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pw2S&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pw2H&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;e1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pSw1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pSw2&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;e2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pH&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pSw1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pSw2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 0.999798020602&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可见，在$P_{spam}=P_{\overline{spam}}=0.5$的情况下，结果和之前是一样的。&lt;/p&gt;

&lt;p&gt;推广到15个词，就得到：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P_{spam|w_1,w_2,\cdots,w_{15}} = \frac{\prod_{i=1}^{15} P_{spam|w_i}}{\prod_{i=1}^{15} P_{spam|w_i} + \prod_{i=1}^{15} (1 - P_{spam|w_i})}&lt;/script&gt;

&lt;h3 id=&quot;实战垃圾邮件过滤&quot;&gt;实战垃圾邮件过滤&lt;/h3&gt;

&lt;h4 id=&quot;公式推导&quot;&gt;公式推导&lt;/h4&gt;

&lt;p&gt;给定一个邮件M，它由文本序列$S=w_1,w_2,\ldots,w_n$组成，则给定邮件为垃圾为垃圾邮件的概率为：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P(spam|M) = P(spam|w_1,w_2,\cdots,w_n) = \frac{P(w_1,w_2,\cdots,w_n|spam) \cdot P(spam)}{P(w_1,w_2,\ldots,w_n|spam) \cdot P(spam) + P(w_1,w_2,\ldots,w_n|\overline{spam}) \cdot P(\overline{spam}) }&lt;/script&gt;

&lt;p&gt;根据朴素贝叶斯的独立性假设，则有：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P(spam|M) \approx \frac{\prod_{i=1}^n P(w_i|spam) \cdot P(spam)}{\prod_{i=1}^n P(w_i|spam) \cdot P(spam) + \prod_{i=1}^n P(w_i|\overline{spam}) \cdot P(\overline{spam}) }&lt;/script&gt;

&lt;h4 id=&quot;模型数据&quot;&gt;模型数据&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;category&lt;/th&gt;
      &lt;th&gt;count&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;spam&lt;/td&gt;
      &lt;td&gt;count1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$\overline{spam}$&lt;/td&gt;
      &lt;td&gt;count2&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;word&lt;/th&gt;
      &lt;th&gt;category&lt;/th&gt;
      &lt;th&gt;count&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_1$&lt;/td&gt;
      &lt;td&gt;spam&lt;/td&gt;
      &lt;td&gt;$w_1c_1$&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_1$&lt;/td&gt;
      &lt;td&gt;$\overline{spam}$&lt;/td&gt;
      &lt;td&gt;$w_1c_2$&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_2$&lt;/td&gt;
      &lt;td&gt;spam&lt;/td&gt;
      &lt;td&gt;$w_2c_1$&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_2$&lt;/td&gt;
      &lt;td&gt;$\overline{spam}$&lt;/td&gt;
      &lt;td&gt;$w_2c_2$&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;…&lt;/td&gt;
      &lt;td&gt;…&lt;/td&gt;
      &lt;td&gt;…&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_n$&lt;/td&gt;
      &lt;td&gt;spam&lt;/td&gt;
      &lt;td&gt;$w_nc_1$&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;$w_n$&lt;/td&gt;
      &lt;td&gt;$\overline{spam}$&lt;/td&gt;
      &lt;td&gt;$w_nc_1$&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;概率计算&quot;&gt;概率计算&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;垃圾邮件概率：$ P(spam) = \frac{count(spam)}{count(spam) + count(\overline{spam})}$&lt;/li&gt;
  &lt;li&gt;正常邮件概率：$P(\overline{spam}) = 1 - P(spam)$&lt;/li&gt;
  &lt;li&gt;$w_i$在垃圾邮件中的概率：&lt;span&gt;$P(w_i|spam) = \frac{count(w_i,spam)}{count(spam)}$，也就是 $\frac{w_i关联的垃圾邮件数量}{垃圾邮件的数量}$&lt;/span&gt;&lt;/li&gt;
  &lt;li&gt;$w_i$在正常邮件中的概率：&lt;span&gt;$P(w_i|\overline{spam}) = \frac{count(w_i,\overline{spam})}{count(\overline{spam})}$，也就是 $\frac{w_i关联的正常邮件数量}{正常邮件的数量}$&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;代码演示&quot;&gt;代码演示&lt;/h4&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;numpy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AntiSpam&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 记录每个词在垃圾邮件和正常邮件中出现的次数&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 记录垃圾邮件和正常邮件中出现的次数&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;incw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setdefault&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{})&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setdefault&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;incm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setdefault&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;train&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;words&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;words&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;incw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;incm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;mc: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;s &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;wc:&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\n\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;wcount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wc&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;category&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;wprob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wcount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;cprob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 利用对数来计算&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;safe_prob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;words&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.0&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;words&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wprob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'spam'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wprob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'health'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cprob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'spam'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cprob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'health'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 利用乘法来计算&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;prob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;words&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sprob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hprob&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;words&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;sprob&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wprob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'spam'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;hprob&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wprob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'health'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sprob&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cprob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'spam'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;hprob&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cprob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'health'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sprob&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sprob&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hprob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;模拟样本训练&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;antiSpam&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AntiSpam&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4989&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;antiSpam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;train&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'hello'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'world'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'todo'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'health'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4901&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;antiSpam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;train&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'invoice'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'bill'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'todo'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'spam'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;antiSpam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;train&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'discount'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'promotion'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'cool'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'health'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;antiSpam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;train&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'spam'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'mail'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'attention'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'health'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;antiSpam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;train&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'discount'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'promotion'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'cool'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'spam'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;90&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;antiSpam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;train&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'spam'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'mail'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'attention'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'spam'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;antiSpam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# mc: {'health': 5000, 'spam': 5000} &lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# wc: {'attention': {'health': 10, 'spam': 90}, 'spam': {'health': 10, 'spam': 90}, 'bill': {'spam': 4901}, 'discount': {'health': 1, 'spam': 9}, 'invoice': {'spam': 4901}, 'mail': {'health': 10, 'spam': 90}, 'world': {'health': 4989}, 'promotion': {'health': 1, 'spam': 9}, 'todo': {'health': 4989, 'spam': 4901}, 'hello': {'health': 4989}, 'cool': {'health': 1, 'spam': 9}}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;垃圾邮件过滤&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;antiSpam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'discount'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'spam'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'todo'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;         &lt;span class=&quot;c&quot;&gt;# 0.987588626017&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;antiSpam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;safe_prob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'discount'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'spam'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'todo'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;# 0.987588626017&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;antiSpam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'hello'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'mail'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'todo'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;            &lt;span class=&quot;c&quot;&gt;# 0.00176901392183&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;antiSpam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;safe_prob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'hello'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'mail'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'todo'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;       &lt;span class=&quot;c&quot;&gt;# 0.00176901392183&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;antiSpam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'hello'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'mail'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'todo'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;            &lt;span class=&quot;c&quot;&gt;# 0.999999995374&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;antiSpam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;safe_prob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'hello'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'mail'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'todo'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;       &lt;span class=&quot;c&quot;&gt;# 0.999999995374&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
        <pubDate>Sun, 10 Sep 2017 23:00:00 +0000</pubDate>
        <link>http://localhost:4000/2017/09/10/naive-bayes-derivation.html</link>
        <guid isPermaLink="true">http://localhost:4000/2017/09/10/naive-bayes-derivation.html</guid>
        
        <category>ml</category>
        
        <category>mathematics</category>
        
        <category>algorithm</category>
        
        <category>python</category>
        
        
        <category>ml</category>
        
      </item>
    
      <item>
        <title>Docker 基础之 Cgroups</title>
        <description>&lt;h2 id=&quot;背景&quot;&gt;背景&lt;/h2&gt;

&lt;p&gt;Cgroups 是 control groups 的缩写，是 Linux 内核提供的一种可以限制、记录、隔离进程组
（process groups）所使用的物理资源（如：cpu,memory,IO 等等）的机制。最初由 google 的
工程师提出，后来被整合进 Linux 内核。Cgroups 也是 LXC 为实现虚拟化所使用的资源管理
手段，可以说没有 cgroups 就没有 LXC。&lt;/p&gt;

&lt;h2 id=&quot;用法&quot;&gt;用法&lt;/h2&gt;
&lt;p&gt;本文演示一下 &lt;code class=&quot;highlighter-rouge&quot;&gt;cgroups&lt;/code&gt; 对 &lt;code class=&quot;highlighter-rouge&quot;&gt;CPU&lt;/code&gt; 资源的控制。&lt;/p&gt;

&lt;h3 id=&quot;准备程序&quot;&gt;准备程序&lt;/h3&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vim full_cpu.go
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;以下程序可以跑满机器的所有核心。&lt;/p&gt;
&lt;div class=&quot;language-go highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;package&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;flag&quot;&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;runtime&quot;&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;fmt&quot;&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cpunum&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cpunum&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cpunum&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cpunum:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cpunum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;runtime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GOMAXPROCS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cpunum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cpunum&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;go&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
	  
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}()&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;

  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;go build full_cpu.go

&lt;span class=&quot;c&quot;&gt;# 查看本机的CPU核心数&lt;/span&gt;
nproc

./full_cpu &lt;span class=&quot;nt&quot;&gt;-cpunum&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;nproc&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;查看程序的资源消耗&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;top &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; james
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/docker-cgroups-01.png&quot; alt=&quot;屏幕快照 2018-09-05 下午5.10.59.png&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;使用-cgroups-控制-cpu-资源&quot;&gt;使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;Cgroups&lt;/code&gt; 控制 &lt;code class=&quot;highlighter-rouge&quot;&gt;CPU&lt;/code&gt; 资源&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Cgroups&lt;/code&gt; 子系统介绍：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;blkio – 这个子系统为块设备设定输入/输出限制，比如物理设备(磁盘，固态硬盘，USB 等 等)。&lt;/li&gt;
  &lt;li&gt;cpu – 这个子系统使用调度程序提供对 CPU 的 cgroup 任务访问。&lt;/li&gt;
  &lt;li&gt;cpuacct – 这个子系统自动生成 cgroup 中任务所使用的 CPU 报告。&lt;/li&gt;
  &lt;li&gt;cpuset – 这个子系统为 cgroup 中的任务分配独立 CPU(在多核系统)和内存节点。&lt;/li&gt;
  &lt;li&gt;devices – 这个子系统可允许或者拒绝 cgroup 中的任务访问设备。&lt;/li&gt;
  &lt;li&gt;freezer – 这个子系统挂起或者恢复 cgroup 中的任务。&lt;/li&gt;
  &lt;li&gt;memory – 这个子系统设定 cgroup 中任务使用的内存限制，并自动生成由那些任务使用的 内存资源报告。&lt;/li&gt;
  &lt;li&gt;net_cls – 这个子系统使用等级识别符(classid)标记网络数据包，可允许 Linux 流量控制程 序(tc)识别从具体 cgroup 中生成的数据包。&lt;/li&gt;
  &lt;li&gt;ns – 名称空间子系统。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Cgroups&lt;/code&gt; 的配置默认在 &lt;code class=&quot;highlighter-rouge&quot;&gt;/sys/fs/cgroup/&lt;/code&gt; 目录下。&lt;/p&gt;

&lt;h4 id=&quot;建立新组-mygroup&quot;&gt;建立新组 &lt;code class=&quot;highlighter-rouge&quot;&gt;mygroup&lt;/code&gt;&lt;/h4&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;sh &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; su root

mkdir /sys/fs/cgroup/cpu/mygroup
&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; /sys/fs/cgroup/cpu/mygroup
&lt;span class=&quot;c&quot;&gt;# cgroup.clone_children  cpuacct.stat          cpu.cfs_period_us  cpu.rt_runtime_us  notify_on_release&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# cgroup.event_control   cpuacct.usage         cpu.cfs_quota_us   cpu.shares         tasks&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# cgroup.procs           cpuacct.usage_percpu  cpu.rt_period_us   cpu.stat&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /sys/fs/cgroup/cpu/mygroup/cpu.cfs_period_us
&lt;span class=&quot;c&quot;&gt;# 100000&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /sys/fs/cgroup/cpu/mygroup/cpu.cfs_quota_us
&lt;span class=&quot;c&quot;&gt;# -1&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /sys/fs/cgroup/cpu/mygroup/tasks
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;只要在 &lt;code class=&quot;highlighter-rouge&quot;&gt;/sys/fs/cgroup/cpu/&lt;/code&gt; 目录下创建完目录，系统就会自动在我们的目录下增加以上文件。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cpu.cfs_period_us&lt;/code&gt; 用来配置时间周期长度，&lt;code class=&quot;highlighter-rouge&quot;&gt;cpu.cfs_quota_us&lt;/code&gt; 用来配置当前 &lt;code class=&quot;highlighter-rouge&quot;&gt;cgroup&lt;/code&gt; 在设置的周期长度内所能使用的CPU时间数，两个文件配合起来设置CPU的使用上限，如果 &lt;code class=&quot;highlighter-rouge&quot;&gt;cpu.cfs_quota_us&lt;/code&gt; 的值为 -1(默认值)，表示不受 cpu 时间的限制。&lt;/p&gt;

&lt;h4 id=&quot;限制-cpu-资源的使用&quot;&gt;限制 &lt;code class=&quot;highlighter-rouge&quot;&gt;CPU&lt;/code&gt; 资源的使用&lt;/h4&gt;

&lt;p&gt;先来看单核的场景&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./full_cpu &lt;span class=&quot;nt&quot;&gt;-cpunum&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /dev/null &amp;amp;
&lt;span class=&quot;c&quot;&gt;# [1] 14986&lt;/span&gt;

top &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; james
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/assets/images/docker-cgroups-02.png&quot; alt=&quot;屏幕快照 2018-09-05 下午5.35.43.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;把 &lt;code class=&quot;highlighter-rouge&quot;&gt;CPU&lt;/code&gt; 资源限制在 &lt;code class=&quot;highlighter-rouge&quot;&gt;10%&lt;/code&gt;。&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;sh &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; su root
&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;100000 | tee /sys/fs/cgroup/cpu/mygroup/cpu.cfs_period_us
&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;10000 | tee /sys/fs/cgroup/cpu/mygroup/cpu.cfs_quota_us


&lt;span class=&quot;c&quot;&gt;# 14986 是上文 full_cpu 程序的 PID&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;14986 | &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;tee /sys/fs/cgroup/cpu/mygroup/tasks

top &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; james
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/docker-cgroups-03.png&quot; alt=&quot;屏幕快照 2018-09-05 下午5.41.29.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;我们再来看看多核的场景&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;sh &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; su root
&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;100000 | tee /sys/fs/cgroup/cpu/mygroup/cpu.cfs_period_us
&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;10000 | tee /sys/fs/cgroup/cpu/mygroup/cpu.cfs_quota_us

./full_cpu &lt;span class=&quot;nt&quot;&gt;-cpunum&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3  &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /dev/null &amp;amp;
&lt;span class=&quot;c&quot;&gt;# [1] 2394&lt;/span&gt;

top &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; james
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/docker-cgroups-04.png&quot; alt=&quot;屏幕快照 2018-09-05 下午8.33.12.png&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 2394 是上文 full_cpu 程序的 PID&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;2394 &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /sys/fs/cgroup/cpu/mygroup/tasks
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/assets/images/docker-cgroups-05.png&quot; alt=&quot;屏幕快照 2018-09-05 下午8.34.18.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这里有一个有意思的地方，&lt;code class=&quot;highlighter-rouge&quot;&gt;CPU&lt;/code&gt; 配额并没有如我们预期地降低到 &lt;code class=&quot;highlighter-rouge&quot;&gt;10%&lt;/code&gt;，而是 &lt;code class=&quot;highlighter-rouge&quot;&gt;210%&lt;/code&gt;，表现上就是我们的配额配置，在同时启动 3 个 &lt;code class=&quot;highlighter-rouge&quot;&gt;goroutine&lt;/code&gt; 的情况下，只对 1 个 &lt;code class=&quot;highlighter-rouge&quot;&gt;CPU&lt;/code&gt; 生效了，另外 2 个 &lt;code class=&quot;highlighter-rouge&quot;&gt;CPU&lt;/code&gt; 完全没有受到影响。这个表现比较诡异，自己查了很多资料也没有找到具体原因，如果有某位看客知道具体原因，还望不吝赐教。&lt;/p&gt;

&lt;h2 id=&quot;其他&quot;&gt;其他&lt;/h2&gt;

&lt;h3 id=&quot;在-centos-上安装-golang&quot;&gt;在 CentOS 上安装 GoLang&lt;/h3&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /tmp
curl &lt;span class=&quot;nt&quot;&gt;-LO&lt;/span&gt; https://storage.googleapis.com/golang/go1.11.linux-amd64.tar.gz

&lt;span class=&quot;c&quot;&gt;# Compare digest with https://storage.googleapis.com/golang/go1.11.linux-amd64.tar.gz.sha256&lt;/span&gt;
sha256sum go1.11.linux-amd64.tar.gz


&lt;span class=&quot;nb&quot;&gt;sudo tar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-C&lt;/span&gt; /usr/local &lt;span class=&quot;nt&quot;&gt;-xvzf&lt;/span&gt; go1.11.linux-amd64.tar.gz
&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; /usr/local/go

&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;:/usr/local/go/bin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
        <pubDate>Fri, 18 Aug 2017 23:00:00 +0000</pubDate>
        <link>http://localhost:4000/2017/08/18/docker-in-cgroups.html</link>
        <guid isPermaLink="true">http://localhost:4000/2017/08/18/docker-in-cgroups.html</guid>
        
        <category>docker</category>
        
        <category>linux</category>
        
        <category>osx</category>
        
        <category>shell</category>
        
        
        <category>docker</category>
        
      </item>
    
      <item>
        <title>Docker 基础之 chroot</title>
        <description>&lt;h2 id=&quot;背景&quot;&gt;背景&lt;/h2&gt;

&lt;h3 id=&quot;什么是chroot&quot;&gt;什么是chroot&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;chroot&lt;/code&gt; 是一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;UNIX&lt;/code&gt; 操作系统上的系统调用，用于将一个进程及其子进程的根目录改变到文件系统中的一个新位置，让这些进程只能访问到该目录。这个功能的想法是为每个进程提供独立的磁盘空间&lt;/p&gt;

&lt;h3 id=&quot;chroot的优势&quot;&gt;chroot的优势&lt;/h3&gt;

&lt;p&gt;在经过 chroot 之后，系统读取到的目录和文件将不在是旧系统根下的而是新根下(即被指定的新的位置)的目录结构和文件，因此它带来的好处大致有以下3个：&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;增加了系统的安全性，限制了用户的权力；
  在经过 chroot 之后，在新根下将访问不到旧系统的根目录结构和文件，这样就增强了系统的安全性。这个一般是在登录 (login) 前使用 chroot，以此达到用户不能访问一些特定的文件。&lt;/li&gt;
  &lt;li&gt;建立一个与原系统隔离的系统目录结构，方便用户的开发；
  使用 chroot 后，系统读取的是新根下的目录和文件，这是一个与原系统根下文件不相关的目录结构。在这个新的环境中，可以用来测试软件的静态编译以及一些与系统不相关的独立开发。&lt;/li&gt;
  &lt;li&gt;切换系统的根目录位置，引导 Linux 系统启动以及急救系统等。
  chroot 的作用就是切换系统的根位置，而这个作用最为明显的是在系统初始引导磁盘的处理过程中使用，从初始 RAM 磁盘 (initrd) 切换系统的根位置并执行真正的 init。另外，当系统出现一些问题时，我们也可以使用 chroot 来切换到一个临时的系统。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;如何使用-chroot&quot;&gt;如何使用 chroot&lt;/h2&gt;

&lt;h3 id=&quot;准备-linux-镜像&quot;&gt;准备 Linux 镜像&lt;/h3&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mkdir -p busybox &amp;amp;&amp;amp; (sudo docker export $(sudo docker create busybox) | tar -C busybox -xvf -)

mkdir -p stretch &amp;amp;&amp;amp; (sudo docker export $(sudo docker create debian:stretch-slim) | tar -C stretch -xvf -)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Busybox&lt;/code&gt; 被称为是嵌入式 &lt;code class=&quot;highlighter-rouge&quot;&gt;Linux&lt;/code&gt; 中的瑞士军刀。&lt;code class=&quot;highlighter-rouge&quot;&gt;Busybox&lt;/code&gt; 包含了许多有用的命令，如 &lt;code class=&quot;highlighter-rouge&quot;&gt;cat&lt;/code&gt;、&lt;code class=&quot;highlighter-rouge&quot;&gt;find&lt;/code&gt; 等，但是它的体积却非常的小，&lt;code class=&quot;highlighter-rouge&quot;&gt;bin&lt;/code&gt; 目录下所有命令都是静态编译，不依赖动态共享库文件。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;debian:stretch-slim&lt;/code&gt; 即为 &lt;code class=&quot;highlighter-rouge&quot;&gt;Debian 9&lt;/code&gt; 的稳定发行版，&lt;code class=&quot;highlighter-rouge&quot;&gt;slim&lt;/code&gt; 表示精简版。&lt;/p&gt;

&lt;h3 id=&quot;执行-chroot&quot;&gt;执行 chroot&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;chroot&lt;/code&gt; 到 &lt;code class=&quot;highlighter-rouge&quot;&gt;busybox&lt;/code&gt; 目录，并执行命令 &lt;code class=&quot;highlighter-rouge&quot;&gt;/bin/busybox --list&lt;/code&gt;。&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;chroot busybox /bin/busybox &lt;span class=&quot;nt&quot;&gt;--list&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code class=&quot;language-txt&quot;&gt;[
[[
acpid
add-shell
addgroup
adduser
adjtimex
ar
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;chroot&lt;/code&gt; 到 &lt;code class=&quot;highlighter-rouge&quot;&gt;busybox&lt;/code&gt; 目录，并执行命令 &lt;code class=&quot;highlighter-rouge&quot;&gt;/bin/sh&lt;/code&gt;。&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;chroot busybox /bin/sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;在 &lt;code class=&quot;highlighter-rouge&quot;&gt;sh&lt;/code&gt; 中执行 &lt;code class=&quot;highlighter-rouge&quot;&gt;busybox&lt;/code&gt; 中的命令&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# bin dev etc home proc root sys tmp usr var&lt;/span&gt;
whoami
&lt;span class=&quot;c&quot;&gt;# root&lt;/span&gt;

mount &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; proc proc /proc
ps aux
&lt;span class=&quot;c&quot;&gt;# PID   USER     TIME  COMMAND&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#    1 root      0:50 /usr/lib/systemd/systemd --system --deserialize 20&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#    2 root      0:00 [kthreadd]&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ...&lt;/span&gt;

ifconfig
&lt;span class=&quot;c&quot;&gt;# ifconfig: /proc/net/dev: No such file or directory&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# docker0   Link encap:Ethernet  HWaddr 02:42:88:28:3C:C5&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#          inet addr:172.17.0.1  Bcast:172.17.255.255  Mask:255.255.0.0&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# eth0      Link encap:Ethernet  HWaddr 00:16:3E:0C:86:F9&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#          inet addr:172.18.113.32  Bcast:172.18.127.255  Mask:255.255.240.0&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;对比宿主机 &lt;code class=&quot;highlighter-rouge&quot;&gt;IP&lt;/code&gt; 配置会发现网络是没有隔离的。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;chroot&lt;/code&gt; 到 &lt;code class=&quot;highlighter-rouge&quot;&gt;stretch&lt;/code&gt; 目录，默认执行 &lt;code class=&quot;highlighter-rouge&quot;&gt;/bin/bash&lt;/code&gt;。&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;chroot stretch
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;在 &lt;code class=&quot;highlighter-rouge&quot;&gt;bash&lt;/code&gt; 中执行 &lt;code class=&quot;highlighter-rouge&quot;&gt;stretch&lt;/code&gt; 中的命令&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/issue
&lt;span class=&quot;c&quot;&gt;# Debian GNU/Linux 9 \n \l&lt;/span&gt;
whoami
&lt;span class=&quot;c&quot;&gt;# root&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;chroot-如何执行可执行文件&quot;&gt;chroot 如何执行可执行文件&lt;/h3&gt;

&lt;p&gt;前面演示了 &lt;code class=&quot;highlighter-rouge&quot;&gt;chroot&lt;/code&gt; 切换到 &lt;code class=&quot;highlighter-rouge&quot;&gt;busybox&lt;/code&gt; 及 &lt;code class=&quot;highlighter-rouge&quot;&gt;stretch&lt;/code&gt; 目录执行命令，给人的感觉好像在使用一个全新的系统。事实上，执行命令的还是宿主操作系统，它只不过把根目录限定在了指定目录，执行文件的相关依赖也必须在此根目录下。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;chroot&lt;/code&gt; 执行命令，并不需要目标目录有一个完整的 &lt;code class=&quot;highlighter-rouge&quot;&gt;linux&lt;/code&gt; 内核，只要是和宿主操作系统同体系符合 &lt;code class=&quot;highlighter-rouge&quot;&gt;ELF&lt;/code&gt; 格式的可执行文件，就可以直接执行。&lt;/p&gt;

&lt;h4 id=&quot;示例1&quot;&gt;示例1&lt;/h4&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rm &lt;span class=&quot;nt&quot;&gt;-fr&lt;/span&gt; rootfs &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; mkdir rootfs
cp ~/busybox/bin/ls ~/rootfs/
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;chroot rootfs ./ls
&lt;span class=&quot;c&quot;&gt;# ls&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;示例2&quot;&gt;示例2&lt;/h4&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rm &lt;span class=&quot;nt&quot;&gt;-fr&lt;/span&gt; rootfs &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; mkdir rootfs
cp ~/busybox/bin/&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;sh,ls,echo,cat,mkdir&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; ~/rootfs/
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;chroot rootfs ./sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./mkdir tmp
./echo &lt;span class=&quot;s1&quot;&gt;'Hello World'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /tmp/hello.txt
./cat /tmp/hello.txt
&lt;span class=&quot;c&quot;&gt;# Hello World&lt;/span&gt;
./ls /
&lt;span class=&quot;c&quot;&gt;# cat    echo   ls     mkdir  sh     tmp&lt;/span&gt;
./ls /tmp
hello.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;示例3&quot;&gt;示例3&lt;/h4&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cp ~/stretch/bin/bash ~/rootfs/
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;chroot rootfs ./bash
&lt;span class=&quot;c&quot;&gt;# chroot: failed to run command ‘./bash’: No such file or directory&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;这里报错，是因为，在 &lt;code class=&quot;highlighter-rouge&quot;&gt;stretch&lt;/code&gt; 的 &lt;code class=&quot;highlighter-rouge&quot;&gt;bash&lt;/code&gt; 不是静态编译的，它依赖于其它的动态库，只有把依赖文件也准备好，&lt;code class=&quot;highlighter-rouge&quot;&gt;bash&lt;/code&gt; 命令才可以正确执行。&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 查看 bash 依赖的动态库&lt;/span&gt;
ldd ~/stretch/bin/bash

mkdir ~/rootfs/lib ~/rootfs/lib64
cp ~/stretch/lib/x86_64-linux-gnu/ld-2.24.so ~/rootfs/lib64/ld-linux-x86-64.so.2
cp ~/stretch/lib/x86_64-linux-gnu/libtinfo.so.5.9 ~/rootfs/lib/libtinfo.so.5
cp ~/stretch/lib/x86_64-linux-gnu/libdl-2.24.so ~/rootfs/lib/libdl.so.2
cp ~/stretch/lib/x86_64-linux-gnu/libc.so.6 ~/rootfs/lib/libc.so.6

tree ~/rootfs
&lt;span class=&quot;c&quot;&gt;# /home/james/rootfs&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ├── bash&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ├── lib&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# │   ├── libc.so.6&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# │   ├── libdl.so.2&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# │   └── libtinfo.so.5&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# └── lib64&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#     └── ld-linux-x86-64.so.2&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#     &lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;chroot rootfs ./bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;chroot-系统调用&quot;&gt;chroot 系统调用&lt;/h3&gt;

&lt;p&gt;上面介绍了 chroot 命令行使用，但是更常见的方式是其它程序语言通过系统调用的方式来使用。chroot 的编写涉及了2个函数，chroot() 以及 chdir()，它们都包含在 unistd.h 头文件中。&lt;/p&gt;

&lt;h4 id=&quot;示例1-1&quot;&gt;示例1&lt;/h4&gt;

&lt;p&gt;本例演示了 &lt;code class=&quot;highlighter-rouge&quot;&gt;chroot&lt;/code&gt; 到 &lt;code class=&quot;highlighter-rouge&quot;&gt;~/busybox&lt;/code&gt; 目录中执行命令。&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vim chroot_demo.py
chmod +x chroot_demo.py
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/env python&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;os&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sys&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Usage: chroot [COMMAND...] &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chroot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/home/james/busybox&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chdir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;umount ./proc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mount -t proc ./proc /proc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;execvp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; ./chroot_demo.py &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# bin dev etc home proc root sys tmp usr var&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; ./chroot_demo.py whoami
&lt;span class=&quot;c&quot;&gt;# root&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; ./chroot_demo.py ps
&lt;span class=&quot;c&quot;&gt;# PID   USER     TIME  COMMAND&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#    1 root      0:49 /usr/lib/systemd/systemd --system --deserialize 20&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#    2 root      0:00 [kthreadd]&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#    3 root      0:02 [ksoftirqd/0]&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ...&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; ./chroot_demo.py ifconfig
&lt;span class=&quot;c&quot;&gt;# docker0   Link encap:Ethernet  HWaddr 02:42:88:28:3C:C5&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#           inet addr:172.17.0.1  Bcast:172.17.255.255  Mask:255.255.0.0&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#           RX packets:3702045 errors:0 dropped:0 overruns:0 frame:0&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#           TX packets:4221866 errors:0 dropped:0 overruns:0 carrier:0&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#           collisions:0 txqueuelen:0&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#           RX bytes:150990614 (143.9 MiB)  TX bytes:36552003396 (34.0 GiB)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# &lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# eth0      Link encap:Ethernet  HWaddr 00:16:3E:0C:86:F9&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#           inet addr:172.18.113.32  Bcast:172.18.127.255  Mask:255.255.240.0&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#           RX packets:105629916 errors:0 dropped:0 overruns:0 frame:0&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#           TX packets:43745130 errors:0 dropped:0 overruns:0 carrier:0&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#           collisions:0 txqueuelen:1000&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#           RX bytes:102811026834 (95.7 GiB)  TX bytes:70775210676 (65.9 GiB)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# &lt;/span&gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;示例2-1&quot;&gt;示例2&lt;/h4&gt;

&lt;p&gt;本例展示如何用系统调用的方式来实现一个类 &lt;code class=&quot;highlighter-rouge&quot;&gt;chroot&lt;/code&gt; 命令。&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vim chroot_rootfs.py
chmod +x chroot_rootfs.py
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/env python&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;os&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sys&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Usage: chroot [COMMAND...] &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;root = {}&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chroot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chdir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getenv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SHELL&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/bin/bash&quot;&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;-i&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:]&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;execvp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;OSError&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;OSError: {0} with command {1}&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./chroot_rootfs.py
Usage: chroot NEWROOT &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;COMMAND...]

&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; ./chroot_rootfs.py ~/busybox /bin/ls
&lt;span class=&quot;c&quot;&gt;# bin dev etc home proc root sys tmp usr var&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
        <pubDate>Wed, 16 Aug 2017 23:00:00 +0000</pubDate>
        <link>http://localhost:4000/2017/08/16/docker-chroot.html</link>
        <guid isPermaLink="true">http://localhost:4000/2017/08/16/docker-chroot.html</guid>
        
        <category>docker</category>
        
        <category>linux</category>
        
        <category>osx</category>
        
        <category>shell</category>
        
        
        <category>docker</category>
        
      </item>
    
      <item>
        <title>在OS X上运行Docker</title>
        <description>&lt;h3 id=&quot;安装virtualbox&quot;&gt;安装VirtualBox&lt;/h3&gt;

&lt;p&gt;VirtualBox可以&lt;a href=&quot;https://www.virtualbox.org/&quot; title=&quot;VirtualBox&quot;&gt;点此&lt;/a&gt;下载。&lt;/p&gt;

&lt;h3 id=&quot;安装docker和boot2docker&quot;&gt;安装docker和boot2docker&lt;/h3&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;brew update
brew install docker
brew install boot2docker
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;启动boot2docker&quot;&gt;启动boot2docker&lt;/h3&gt;

&lt;p&gt;docker刚开始推出的时候，只支持ubuntu。因为docker依赖于linux container，默认是不支持OS X系统的。
因此如果我们想在OS X上使用docker，就必须借助boot2docker。&lt;/p&gt;

&lt;div&gt;
&lt;img alt=&quot;docker-in-linux&quot; width=&quot;341&quot; height=&quot;396&quot; src=&quot;data:image/png;base64,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&quot; /&gt;
&lt;img alt=&quot;docker-in-osx&quot; width=&quot;343&quot; height=&quot;460&quot; src=&quot;data:image/png;base64,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&quot; /&gt;
&lt;/div&gt;

&lt;h4 id=&quot;初始化boot2docker&quot;&gt;初始化boot2docker&lt;/h4&gt;

&lt;p&gt;如果你是第一次执行，必须先初始化boot2docker，默认它会下载&lt;code class=&quot;highlighter-rouge&quot;&gt;boot2docker.iso&lt;/code&gt;到目录&lt;code class=&quot;highlighter-rouge&quot;&gt;~/.boot2docker/&lt;/code&gt;中。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;boot2docker是基于 Tiny Core Linux 的轻量级Linux发行版，专为 Docker准备，完全运行于内存中，24M大小，启动仅5-6秒。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boot2docker init
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;启动boot2docker&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boot2docker up

&lt;span class=&quot;c&quot;&gt;# 可以使用如下命令登陆boot2docker系统&lt;/span&gt;
boot2docker ssh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;升级boot2docker虚拟映像&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boot2docker stop
boot2docker download
boot2docker up
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;或者使用如下命令升级boot2docker&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boot2docker upgrade
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;设置docker相关的环境变量&quot;&gt;设置docker相关的环境变量&lt;/h3&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DOCKER_HOST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;tcp://192.168.59.103:2376
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DOCKER_CERT_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/Users/james/.boot2docker/certs/boot2docker-vm
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DOCKER_TLS_VERIFY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;
  &lt;p&gt;一般在第一次启动完成后，docker会提示配置这些信息，具体配置以其提示为准。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 检查docker启动后的相关信息&lt;/span&gt;
docker info
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;启动container&quot;&gt;启动Container&lt;/h3&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run hello-world
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如果你看到消息&lt;code class=&quot;highlighter-rouge&quot;&gt;This message shows that your installation appears to be working correctly&lt;/code&gt;，说明你的docker环境已经配置好了。&lt;/p&gt;

&lt;p&gt;启动Ubuntu容器&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run &lt;span class=&quot;nt&quot;&gt;-it&lt;/span&gt; ubuntu bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;启动Nginx容器&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 80:80 &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; web nginx

&lt;span class=&quot;c&quot;&gt;#可以使用如下命令来测试当前的Nginx容器&lt;/span&gt;
curl &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;boot2docker ip&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可以使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;docker ps&lt;/code&gt; 来查看当前活跃的进程，可以使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;docker stop web&lt;/code&gt; 来结束指定容器，或者使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;docker rm web&lt;/code&gt; 来删除指定容器。&lt;/p&gt;

&lt;h3 id=&quot;参考资料&quot;&gt;参考资料&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;http://dockerpool.com/static/books/docker_practice/index.html&quot; title=&quot;Docker从入门到实践&quot;&gt;Docker从入门到实践&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

</description>
        <pubDate>Fri, 15 May 2015 23:00:00 +0000</pubDate>
        <link>http://localhost:4000/2015/05/15/docker-in-osx.html</link>
        <guid isPermaLink="true">http://localhost:4000/2015/05/15/docker-in-osx.html</guid>
        
        <category>docker</category>
        
        <category>linux</category>
        
        <category>osx</category>
        
        <category>shell</category>
        
        
        <category>docker</category>
        
      </item>
    
  </channel>
</rss>
